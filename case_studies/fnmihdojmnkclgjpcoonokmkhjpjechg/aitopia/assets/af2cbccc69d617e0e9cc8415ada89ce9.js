import{p as v,a as w,b as F}from"./a0c4928e138c271c0a4ffa7387169967.js";import{A as U,_ as x}from"./2341679a9c28c37b2ec2d727070e24de.js";import{H as P,A as E}from"./6da4b6d82d745093c67f68f3dfd58024.js";import{F as b}from"./153f558d7d25f9316436c23acae25c23.js";import{d as k,a_ as g,H as C,aP as c,bH as I,L as r,J as h,I as _,bc as f,X as y,aA as A,bM as m}from"./0d312bf4a86f7694fa93a4b284d7250e.js";import"./ddf3c1fa2deb5d26638675926c7b9d09.js";import"./cde26fce7a7372b6951c2916a9851051.js";import"./a284a60fa67a17f88f7ec49cd2e14d13.js";import"./c775b28d320b0f76df5f528bc49f6aa4.js";import"./556eec616e9e2e42b8c2aa2bb68d535c.js";import"./e10687645c95ce1b6a3461c73a73ba81.js";import"./6bde0597aea7748c1fc7d905f85ec069.js";import"./6b2aa0f0aa2b0110b5bd650a97a56803.js";import"./6a9d2cf74beb95f898ebba51cb126aec.js";import"./aff28b06e242157a60245cfbcb54fdee.js";import"./1539025a706a9e27b0becf940dc1c28a.js";import"./36be3a95664330bdd5ec4bf0678814b0.js";import"./d9ead636e14b3dea7802a6c456951ba1.js";import"./0adcd388c9aaa32c0cc27d4165b3d44d.js";import"./0b28c5808c8427156e8784d960d4e59e.js";import"./af99b7f1a072a4003eb9ccc27570713e.js";import"./7e175aa4d215965863ad94e5816e68dc.js";import"./b89c276e0b74378882f480951f4bde2a.js";import"./f40af6e9496ae6e6e39e8fe1c143aa85.js";import"./1343aedc4180a91956bf1ecf1fac242a.js";import"./5ae9c9acb1c829f4ab2c50786720e5cf.js";import"./6d1994eb1dc6c7b66d71c8cf9501e5ea.js";import"./505fa308d2bad83a0d0f7db4aad799e6.js";import"./db2d9de47c2cd9f7c89e9f65becb64bc.js";import"./d2d811bcbf8f364c09354b3094d627ac.js";import"./3a52cdb9a73d8582fc76a67c93707d2d.js";import"./1b14d4146f0939dc840d5b2134463ed7.js";import"./597982f5e7ea616818fbc2ceedb386b7.js";import"./9f5a820a7a10de0699f93f20575efc5e.js";import"./2b9dd6c04c32a40b8a9fce6d879a445d.js";import"./f37f6b6bbb5f63bf0bfafb8a112416af.js";import"./152fe5418b14a2dacb069c86b6fade15.js";import"./e19892cc69af37d0ed63f93ba3ce63a3.js";import"./7e819cd5e0fcd6ebf5950224b361b421.js";import"./fcb632058ec5a26831181cf03980c901.js";F.GlobalWorkerOptions.workerSrc=w;const M=async e=>await new Promise((a,o)=>{const n=new FileReader;n.onload=async d=>{var l;if((l=d.target)!=null&&l.result)try{const t=await v.getDocument({data:d.target.result}).promise;let i="";for(let s=1;s<=t.numPages;s++)try{const u=await(await t.getPage(s)).getTextContent();i+=u.items.map(D=>D.str).join(" ")}catch(p){console.log(`Error occurred while reading page ${s}: ${p}`);continue}t.destroy(),a(i)}catch(t){o(`Error occurred while reading PDF file: ${t}`)}else o("No result found")},n.onerror=()=>{o(`Error occurred while reading file: ${n.error}`)},n.readAsArrayBuffer(e)}),S=k({extends:U,name:"PdfUploader",computed:{acceptedFileTypes(){return".pdf,.doc,.docx,.xlsx,.xls,.ppt,.pptx"}},data(){return{pdfUploadErrorMessage:"",pdfUploadPromptId:"",pdfUploadIsProcessing:!1,pdfUploadDragActive:!1}},methods:{async uploadPDF(e){const a=e.target.files[0];await this.processFile(a)},dragOver(e){e.preventDefault(),this.pdfUploadDragActive=!0},dragEnter(e){e.preventDefault(),this.pdfUploadDragActive=!0},dragLeave(e){e.preventDefault(),this.pdfUploadDragActive=!1},async handleDrop(e){const a=e.dataTransfer.files[0];await this.processFile(a)},async processFile(e){if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(e.type)){this.pdfUploadErrorMessage=this.__("Please upload a PDF, Word, Excel, or PowerPoint file");return}this.pdfUploadErrorMessage="",this.pdfUploadIsProcessing=!0;try{let o="";if(e.type!=="application/pdf"){const l=b.getInstance();try{await l.loadPDF(e);const t=l.getPdfDoc();if(!t)throw new Error("Failed to convert file to PDF format");for(let i=1;i<=t.numPages;i++)try{const p=await(await t.getPage(i)).getTextContent();o+=p.items.map(u=>u.str).join(" ")}catch(s){console.log(`Error occurred while reading page ${i}: ${s}`);continue}await l.cleanup()}catch(t){console.error("Error converting file:",t),this.pdfUploadErrorMessage=this.__("Error processing this file format. Please try again or use a PDF file."),this.pdfUploadIsProcessing=!1;return}}else o=await M(e);if(o===""){this.pdfUploadErrorMessage=this.__("Content of the file is empty. Please upload a regular PDF file. Photo converted PDF files cannot be used at ChatPDF"),this.pdfUploadIsProcessing=!1;return}this.changeStorage("settings.web_access",!1,!1),this.pdfUploadPromptId=P.SHA1(this.getFileName(e));const n="",d=e.name;this.newChat(),this.closeModel(),this.changeStorage("settings.ai_model",this.constants.ai_default_model),this.aiChat(o,this.constants.ai_default_model,"ai_chat","__all",!0,!1,d,!1,{is_pdf:!0,prompt_prefix:E.prompt_prefix,language_name:this.settings.language_name}),document.querySelector("#fileInputPDF")!=null&&(document.querySelector("#fileInputPDF").value=null)}catch(o){console.log(o),this.pdfUploadErrorMessage=this.__("Something went wrong. Please try again.")}finally{this.pdfUploadIsProcessing=!1}},getFileName(e){return P.slugify(e.name)},closeModel(){let e=document.querySelector('[data-aifnmjmchg-dropdown-toggle="aifnmjmchg-pdf-upload-modal"]');e&&(this.pdfUploadPromptId="",e.click()),e=document.querySelector("#aifnmjmchg-pdf-upload-modal button[data-modal-hide]"),e&&(this.pdfUploadPromptId="",e.click())}}}),$={class:"aifnmjmchg-p-4 aifnmjmchg-w-full aifnmjmchg-text-center aifnmjmchg-flex aifnmjmchg-flex-col aifnmjmchg-items-center aifnmjmchg-gap-3"},N={class:"aifnmjmchg-px-4 aifnmjmchg-text-sm aifnmjmchg-text-neutral-600 dark:aifnmjmchg-text-neutral-400"},T=["disabled","accept"],B={for:"fileInputPDF",class:"aifnmjmchg-w-full aifnmjmchg-h-full aifnmjmchg-relative aifnmjmchg-z-[9999]"},H={class:"aifnmjmchg-flex aifnmjmchg-flex-col aifnmjmchg-w-full aifnmjmchg-p-6 aifnmjmchg-items-center aifnmjmchg-justify-center aifnmjmchg-mt-4 aifnmjmchg-border-2 aifnmjmchg-border-dotted aifnmjmchg-border-neutral-300 dark:aifnmjmchg-border-neutral-700 aifnmjmchg-rounded-lg aifnmjmchg-text-neutral-600 dark:aifnmjmchg-text-neutral-400 aifnmjmchg-text-center aifnmjmchg-cursor-pointer aifnmjmchg-transition-all hover:aifnmjmchg-opacity-70"},q={class:"aifnmjmchg-flex aifnmjmchg-flex-col aifnmjmchg-items-center aifnmjmchg-gap-1 aifnmjmchg-mt-2"},W={class:"aifnmjmchg-block aifnmjmchg-text-xs"},L={key:0,class:"aifnmjmchg-flex aifnmjmchg-justify-center aifnmjmchg-items-center aifnmjmchg-h-25"},O={class:"aifnmjmchg-h-6"},V={key:0,class:"aifnmjmchg-text-red-500 ai-aifnmjmchgtext-sm"},j={key:0,class:"aifnmjmchg-p-4"};function z(e,a,o,n,d,l){const t=g("svg-logo"),i=g("single-response"),s=g("modal");return c(),C(s,{title:e.__("Upload File"),id:"aifnmjmchg-pdf-upload-modal",className:"aifnmjmchg-items-center",onDrop:m(e.handleDrop,["prevent"]),onDragover:m(e.dragOver,["prevent"]),onDragenter:m(e.dragEnter,["prevent"]),onDragleave:m(e.dragLeave,["prevent"])},{default:I(()=>[r("div",$,[r("p",N,f(e.__("Upload a PDF, Word, Excel, or PowerPoint file to easily get intelligent summaries and answers for your documents.")),1),r("input",{type:"file",id:"fileInputPDF",onChange:a[0]||(a[0]=(...p)=>e.uploadPDF&&e.uploadPDF(...p)),disabled:e.pdfUploadIsProcessing,accept:e.acceptedFileTypes,style:{display:"none"}},null,40,T),r("label",B,[r("div",H,[y(t,{className:"aifnmjmchg-w-16 aifnmjmchg-h-16 aifnmjmchg-opacity-60",name:"file_icon"}),r("div",q,[r("span",W,f(e.__("Supported file types are PDF, Word, Excel, and PowerPoint")),1)]),r("span",{class:A(["aifnmjmchg-block aifnmjmchg-mt-2",e.pdfUploadDragActive?"aifnmjmchg-opacity-100":"aifnmjmchg-opacity-60"])},f(e.pdfUploadDragActive?e.__("Drop your file here"):e.__("Drag your file here or click to upload")),3)])]),e.pdfUploadIsProcessing?(c(),h("div",L,a[1]||(a[1]=[r("div",{class:"aifnmjmchg-border-4 aifnmjmchg-border-solid aifnmjmchg-border-t-transparent aifnmjmchg-border-gray-200 aifnmjmchg-rounded-full aifnmjmchg-w-9 aifnmjmchg-h-9 aifnmjmchg-animate-spin"},null,-1)]))):_("",!0),r("div",O,[e.pdfUploadErrorMessage?(c(),h("p",V,f(e.pdfUploadErrorMessage),1)):_("",!0)])]),this.pdfUploadPromptId?(c(),h("div",j,[y(i,{class:"aifnmjmchg-p-2 aifnmjmchg-rounded-lg aifnmjmchg-bg-neutral-100 dark:aifnmjmchg-bg-neutral-900 dark:aifnmjmchg-text-gray-200",id:"aifnmjmchg-pdf-summary",custom_key:this.pdfUploadPromptId,onContinueChatClick:this.closeModel},null,8,["custom_key","onContinueChatClick"])])):_("",!0)]),_:1},8,["title","onDrop","onDragover","onDragenter","onDragleave"])}const Me=x(S,[["render",z]]);export{Me as default};
