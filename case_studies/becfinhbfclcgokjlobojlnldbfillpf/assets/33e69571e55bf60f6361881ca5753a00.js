import{p as D,a as w,b as F}from"./f034a69a89413642eeb358901abf7dcf.js";import{A as U,F as x,_ as k}from"./f1cb0a108b35713614332c7c219352b8.js";import{H as _}from"./0f34bc84b746331fb6e6d1a17e2be5f1.js";import{F as E}from"./73621e66aaefef21fc49c7b09fcb8ca2.js";import{d as b,O as h,I,j as c,s as C,v as l,g as y,G as P,K as f,q as v,n as M,bM as m}from"./71531b053591a96d81db2519a82aa248.js";import"./3f2064fa9a9acc842de50ad820610f4b.js";import"./aca89d4ca34e8fbbc6f322cb34935489.js";import"./20a792c886a1e97f2e0afd17d252e1f4.js";import"./17e6f969c69a33c57a5b808c30e97817.js";import"./8fd9dd871ac56148ba64599be5846cf8.js";import"./c12fd3596e1e986fac56d091ec67c779.js";import"./0db5daaf91bdd56249e9ae30e1c0fad3.js";import"./4bf0dc39263bec45ac08f22b6445195f.js";import"./7694ab0a99e001fc6c4a0dff919c3a14.js";import"./c2c13b7def76f5768e17bc73b900b28e.js";import"./9cb1ced478fdea687c5b1bf07fa2b7a3.js";import"./9f935c62533cde17533373075512c98b.js";import"./83c6672847a35da18c7c6cd5f39ddc2c.js";import"./8f849a317394192d6541e23f7f7dff92.js";import"./d541e75e0d3013fe2efd3bb1a31c4a6b.js";import"./7e56edcc34c4dfd4bce3410bed0529e6.js";import"./bd5159ed1face2f59751ceb1d07e31f3.js";import"./22aa1f89111f8237764a195a86dc6791.js";import"./1c66977a9e497032052fc88de8dc0025.js";import"./2eb62d616ebc70b625c1907fb9b56bcb.js";import"./167eb5fb14130edc55e0208b299eb738.js";import"./e43206e4b2ef10bccecb7d9deb74b927.js";import"./39c3d8a964c661ab72f6d2e5dcdb0e9a.js";import"./0a9beade9558a5b904150914951edb50.js";import"./f54e67aceb61bff7ffa40ea09bc1d32b.js";import"./213f32d162da0b49b503a8a6bbbc48c5.js";import"./3bba0132cadb8367ad0a83c5b642cc05.js";import"./a7f3568b8a3b9ed5f4c7071a6647ff03.js";import"./85f9b9aa825fd52abbb9d9abb51bcccc.js";import"./845116a858117a73133ec07f5fc03fd7.js";import"./47c00f65ef7725e7b9291a5d4e878b12.js";import"./3aa3bad61540a8235df7f238b2b2bef2.js";import"./d689743b45b83766b445f5e3a7f83067.js";import"./d90a1dadfd9d56c6157b026a43a3acf9.js";import"./be62c323ef7199eed02717bc155004ba.js";import"./dcbabf58cd14346bf8b00e4313a9ce1e.js";import"./1c9c6c0e4e61684cbb170ab72d0e89e2.js";F.GlobalWorkerOptions.workerSrc=w;const A=async e=>await new Promise(((a,t)=>{const i=new FileReader;i.onload=async e=>{var i;if(null!=(i=e.target)&&i.result)try{const t=await D.getDocument({data:e.target.result}).promise;let i="";for(let e=1;e<=t.numPages;e++)try{const a=undefined;i+=(await(await t.getPage(e)).getTextContent()).items.map((e=>e.str)).join(" ")}catch(o){console.log(`Error occurred while reading page ${e}: ${o}`);continue}t.destroy(),a(i)}catch(r){t(`Error occurred while reading PDF file: ${r}`)}else t("No result found")},i.onerror=()=>{t(`Error occurred while reading file: ${i.error}`)},i.readAsArrayBuffer(e)})),S=b({extends:U,name:"PdfUploader",computed:{acceptedFileTypes:()=>".pdf,.doc,.docx,.xlsx,.xls,.ppt,.pptx"},data:()=>({pdfUploadErrorMessage:"",pdfUploadPromptId:"",pdfUploadIsProcessing:!1,pdfUploadDragActive:!1}),methods:{async uploadPDF(e){var a;const t=(null==(a=e.target.files)?void 0:a[0])||null;t&&await this.processFile(t)},dragOver(e){e.preventDefault(),this.pdfUploadDragActive=!0},dragEnter(e){e.preventDefault(),this.pdfUploadDragActive=!0},dragLeave(e){e.preventDefault(),this.pdfUploadDragActive=!1},async handleDrop(e){var a;const t=(null==(a=e.dataTransfer.files)?void 0:a[0])||null;t&&await this.processFile(t)},async processFile(e){if(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(e.type)){this.pdfUploadErrorMessage="",this.pdfUploadIsProcessing=!0;try{let i="",o=null;try{const a=await x.set(e,null,null);a&&a._listkey&&(o=a._listkey)}catch{}if("application/pdf"!==e.type){const o=E.getInstance();try{await o.loadPDF(e);const t=o.getPdfDoc();if(!t)throw new Error("Failed to convert file to PDF format");for(let e=1;e<=t.numPages;e++)try{const a=undefined;i+=(await(await t.getPage(e)).getTextContent()).items.map((e=>e.str)).join(" ")}catch(a){console.log(`Error occurred while reading page ${e}: ${a}`);continue}await o.cleanup()}catch(t){return console.error("Error converting file:",t),this.pdfUploadErrorMessage=this.__("Error processing this file format. Please try again or use a PDF file."),void(this.pdfUploadIsProcessing=!1)}}else i=await A(e);if(""===i)return this.pdfUploadErrorMessage=this.__("Content of the file is empty. Please upload a regular PDF file. Photo converted PDF files cannot be used at ChatPDF"),void(this.pdfUploadIsProcessing=!1);this.changeStorage("settings.web_access",!1,!1),e&&(this.pdfUploadPromptId=_.SHA1(this.getFileName(e)));const r="",s=e.name;if(o){const a=this.attached_files&&Array.isArray(this.attached_files)?this.attached_files:[],t={id:o,name:s,size:e.size,type:e.type},i=[...a.filter((e=>e.id!==o)),t];this.attached_files=i,this.changeStorage("attached_files",i,!1)}this.closeModel(),null!=document.querySelector("#fileInputPDF")&&(document.querySelector("#fileInputPDF").value=null)}catch(i){console.log(i),this.pdfUploadErrorMessage=this.__("Something went wrong. Please try again.")}finally{this.pdfUploadIsProcessing=!1}}else this.pdfUploadErrorMessage=this.__("Please upload a PDF, Word, Excel, or PowerPoint file")},getFileName:e=>_.slugify(e.name),closeModel(){let e=document.querySelector('[data-ait-dropdown-toggle="ait-pdf-upload-modal"]');e&&(this.pdfUploadPromptId="",e.click()),e=document.querySelector("#ait-pdf-upload-modal button[data-modal-hide]"),e&&(this.pdfUploadPromptId="",e.click())}}}),$={class:"ait-p-4 ait-w-full ait-text-center ait-flex ait-flex-col ait-items-center ait-gap-3"},N={class:"ait-px-4 ait-text-sm ait-text-neutral-600 dark:ait-text-neutral-400"},T=["disabled","accept"],q={for:"fileInputPDF",class:"ait-w-full ait-h-full ait-relative ait-z-[9999]"},B={class:"ait-flex ait-flex-col ait-w-full ait-p-6 ait-items-center ait-justify-center ait-mt-4 ait-border-2 ait-border-dotted ait-border-neutral-300 dark:ait-border-neutral-700 ait-rounded-lg ait-text-neutral-600 dark:ait-text-neutral-400 ait-text-center ait-cursor-pointer ait-transition-all hover:ait-opacity-70"},z={class:"ait-flex ait-flex-col ait-items-center ait-gap-1 ait-mt-2"},O={class:"ait-block ait-text-xs"},W={key:0,class:"ait-flex ait-justify-center ait-items-center ait-h-25"},j={class:"ait-h-6"},H={key:0,class:"ait-text-red-500 ai-text-sm"},V={key:0,class:"ait-p-4"};function G(e,a,t,i,o,r){const s=h("svg-logo"),d=h("single-response"),p=h("modal");return c(),I(p,{title:e.__("Upload File"),id:"ait-pdf-upload-modal",className:"ait-items-center",onDrop:m(e.handleDrop,["prevent"]),onDragover:m(e.dragOver,["prevent"]),onDragenter:m(e.dragEnter,["prevent"]),onDragleave:m(e.dragLeave,["prevent"])},{default:C((()=>[l("div",$,[l("p",N,f(e.__("Upload a PDF, Word, Excel, or PowerPoint file to easily get intelligent summaries and answers for your documents.")),1),l("input",{type:"file",id:"fileInputPDF",onChange:a[0]||(a[0]=(...a)=>e.uploadPDF&&e.uploadPDF(...a)),disabled:e.pdfUploadIsProcessing,accept:e.acceptedFileTypes,style:{display:"none"}},null,40,T),l("label",q,[l("div",B,[v(s,{className:"ait-w-16 ait-h-16 ait-opacity-60",name:"file_icon"}),l("div",z,[l("span",O,f(e.__("Supported file types are PDF, Word, Excel, and PowerPoint")),1)]),l("span",{class:M(["ait-block ait-mt-2",e.pdfUploadDragActive?"ait-opacity-100":"ait-opacity-60"])},f(e.pdfUploadDragActive?e.__("Drop your file here"):e.__("Drag your file here or click to upload")),3)])]),e.pdfUploadIsProcessing?(c(),y("div",W,a[1]||(a[1]=[l("div",{class:"ait-border-4 ait-border-solid ait-border-t-transparent ait-border-gray-200 ait-rounded-full ait-w-9 ait-h-9 ait-animate-spin"},null,-1)]))):P("",!0),l("div",j,[e.pdfUploadErrorMessage?(c(),y("p",H,f(e.pdfUploadErrorMessage),1)):P("",!0)])]),this.pdfUploadPromptId?(c(),y("div",V,[v(d,{class:"ait-p-2 ait-rounded-lg ait-bg-neutral-100 dark:ait-bg-neutral-900 dark:ait-text-gray-200",id:"aitopia-pdf-summary",custom_key:this.pdfUploadPromptId,onContinueChatClick:this.closeModel},null,8,["custom_key","onContinueChatClick"])])):P("",!0)])),_:1},8,["title","onDrop","onDragover","onDragenter","onDragleave"])}const $e=k(S,[["render",G]]);export{$e as default};