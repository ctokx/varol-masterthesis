import{B as oe}from"./d541e75e0d3013fe2efd3bb1a31c4a6b.js";import{d as ce,o as fe}from"./7e56edcc34c4dfd4bce3410bed0529e6.js";import{C as I}from"./aca89d4ca34e8fbbc6f322cb34935489.js";import{d as ue}from"./17e6f969c69a33c57a5b808c30e97817.js";import{M as de}from"./c12fd3596e1e986fac56d091ec67c779.js";import{m as pe}from"./0db5daaf91bdd56249e9ae30e1c0fad3.js";import{H as ne}from"./4bf0dc39263bec45ac08f22b6445195f.js";import{m as ge}from"./bd5159ed1face2f59751ceb1d07e31f3.js";import"./9f935c62533cde17533373075512c98b.js";import{l as he}from"./22aa1f89111f8237764a195a86dc6791.js";const u={Local:{},Sync:{},LocalOld:{},SyncOld:{},LocalQuote:0,LocalUsageQuote:0,LocalKeyByUsage:{},constructor(){},build:async(e="local",t=0)=>await new Promise((async(a,n)=>await s.Browser().storage[e].get(null).then((async n=>{let i=s.firstUpperCase(e),o=u[i];return Object.keys(n).forEach((e=>{typeof o[e]<"u"&&delete o[e]})),Object.keys(o).length>0&&(await s.Browser().storage[e].set(o),n=Object.assign(o,n)),u[i]=s.JsonParse(n),0==u.LocalUsageQuote&&await u.quoteCheck(),a(1==t?u[e]:u)})).catch((async e=>{if(console.log(e),-1!==e.indexOf("QUOTA_BYTES"))return await u.cleanUpStorage(!0);console.log(e)})))),async listener(e){return typeof s.Browser().storage.migration_status>"u"&&(s.Browser().storage.migration_status=!1),s.Browser().storage.onChanged.addListener(((t,a)=>{let n=Object.keys(t);if(-1!==n.indexOf("migration_status")){let e=n[n.indexOf("migration_status")];s.Browser().storage.migration_status=t[e].newValue??!1}return Object.keys(t).forEach((e=>{let n=e,s=t[e].oldValue,i=t[e].newValue;if(typeof u[a]>"u"&&(u[a]={}),typeof u[`${a}Old`]>"u"&&(u[`${a}Old`]={}),typeof i<"u"&&null!=i?typeof i[n]<"u"?this[a][n]=u[a][n]=i[n]:this[a][n]=u[a][n]=i:this[a][n]=u[a][n]=null,typeof s<"u"&&null!=s?typeof s[n]<"u"?this[`${a}Old`][n]=u[`${a}Old`][n]=s[n]:this[`${a}Old`][n]=u[`${a}Old`][n]=s:this[`${a}Old`][n]=u[`${a}Old`][n]=null,-1!==n.indexOf("ai_single_")){let e=n.replace("ai_single_","");null==this[a].ai_single&&(this[a].ai_single=u[a].ai_single={}),this[a].ai_single&&typeof this[a].ai_single[e]>"u"&&(this[a].ai_single[e]=u[a].ai_single[e]={}),typeof i[n]<"u"?this[a].ai_single[e]=u[a].ai_single[e]=i[n]:this[a].ai_single[e]=u[a].ai_single[e]=i,console.log(u[a].ai_single[e],i[n],i)}})),e.storage=u,Object.keys(t).forEach((t=>{let n=JSON.stringify(u[a][t])||u[a][t],i=JSON.stringify(u[`${a}Old`][t])||u[`${a}Old`][t];"settings"==t&&null==u[a][t]&&console.error(t,u[a][t]),n!=i&&e.changeListener(a,t,u[a][t],u[`${a}Old`][t],s.Browser().storage.migration_status??!1)})),u}))},async quoteCheck(){if(typeof s.Browser().storage.local.QUOTA_BYTES<"u"){u.LocalQuote=s.Browser().storage.local.QUOTA_BYTES;let e=0,t=await s.Browser().storage.local.get();t&&(Object.keys(t).forEach((a=>{let n={};n[a]=t[a];let s=new Blob([JSON.stringify(n)]).size;e+=s,this.LocalKeyByUsage[a]=s})),u.LocalUsageQuote=e,await u.cleanUpStorage())}},async cleanUpStorage(e=!1){let t=u.LocalQuote,a=u.LocalUsageQuote,n,i=!1,o=null,l=5e4,r=19;if(t-=2e5,t<=a||1==e){console.log(t,a,e,t<=a||1==e);let n=await s.Browser().storage.local.get("ai_chat");if(typeof n.ai_chat<"u"){let e=n.ai_chat;if(null!==e){let t=Object.keys(e);t.length>11?t.forEach((e=>{Number.parseInt(e)>0&&Object.keys(n.ai_chat).length>r&&(delete n.ai_chat[e],n.ai_chat=Object.values(n.ai_chat),i=!0,o="ai_chat")})):t.forEach((t=>{e[t]&&typeof e[t].item<"u"&&(e[t].item.length>l?(n.ai_chat[t].item=e[t].item=e[t].item.toString().substring(0,l),i=!0,o="ai_chat"):typeof e[t].prompt<"u"&&e[t].prompt.length>l&&(n.ai_chat[t].prompt=e[t].prompt=e[t].prompt.toString().substring(0,l),i=!0,o="ai_chat"))}))}}if(i&&null!=o)return await s.Browser().storage.local.set(n).catch((async e=>{-1!==e.indexOf("QUOTA_BYTES")&&(await s.Browser().storage.local.remove(o),await s.Browser().storage.local.set(n))})),u.quoteCheck()}}},j={db_name:"AiTopia",open_db:null,db_version:1,open:async(e=null)=>{if(null!=e&&(j.db_name=e),location&&location.search&&-1!==location.search.indexOf("clear")&&null==j.open_db){await indexedDB.deleteDatabase(j.db_name);let e=new URLSearchParams(location.search);e.delete("clear"),Object.keys(e).length>0?window.location.href=window.location.origin+"?"+e.toString()+location.hash:window.location.href=window.location.origin}return j.open_db=await fe(j.db_name,j.db_version,{upgrade(e,t,a,n,s){e.createObjectStore(j.db_name,{keyPath:"key",autoIncrement:!1})},blocked(e,t,a){console.log("BLOCKED")},blocking(e,t,a){console.log("BLOCKING")},terminated(){console.log("TERMINATE")}})},storage:{get:async(e=null)=>{let t={};return"string"==typeof e&&null!=e&&(e=[e]),(null==e||"object"!=typeof e)&&(e=[]),new Promise((async(a,n)=>{let i=await j.open();try{let e=await i.transaction(j.db_name,"readonly").objectStore(j.db_name)}catch(c){return void console.log(c)}let o=await i.transaction(j.db_name,"readonly").objectStore(j.db_name),l=!1,r=[];if(e&&e.length>0){for(let t of e){let e=null;s.notUndefined(u.Local,t)?e={key:t,value:s.notUndefined(u.Local,t)}:(t=s.AesEnCrypt(t),e=await o.get(t),s.notUndefined(e,"key")&&(e.key=s.AesDeCrypt(e.key)??e.key),s.notUndefined(e,"value")&&(e.value=s.JsonParse(s.AesDeCrypt(e.value)??e.value))),r.push(e)}l=!0}l||(r=await o.getAll()),r&&r.forEach((e=>{if(s.notUndefined(e,"value")){let a=s.notUndefined(e,"key"),n=s.notUndefined(e,"value");l||(a=s.AesDeCrypt(a)??null,n=s.JsonParse(s.AesDeCrypt(n)??null)??null),t[a]=u.Local[a]=n}})),a(t)}))},set:async(e={})=>await new Promise((async(t,a)=>{let n=await(await j.open()).transaction(j.db_name,"readwrite").objectStore(j.db_name),i={};if(e&&Object.keys(e).length>0){let t=!1;for(const a of Object.keys(e)){let o=!1;e[a]=s.JsonParse(e[a]);let l={key:s.AesEnCrypt(a),value:s.AesEnCrypt(JSON.stringify(e[a]))??null,updated_date:(new Date).getTime()},r=await n.getKey(s.AesEnCrypt(a)),c=await n.get(s.AesEnCrypt(a));s.notUndefined(c,"key")&&(c.key=s.AesDeCrypt(c.key)??c.key),s.notUndefined(c,"value")&&(c.value=s.JsonParse(s.AesDeCrypt(c.value)??c.value)),typeof r>"u"?(await n.add(l),t=o=!0,i[a]={oldValue:null,newValue:e[a]}):s.notUndefined(c,"value")!=JSON.stringify(e[a])&&(i[a]={oldValue:null,newValue:e[a]},i[a].oldValue=s.JsonParse(s.notUndefined(c,"value")??null)??null,await n.put(l),t=o=!0),o&&(u.Local[a]=e[a])}t&&window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:i}))}t(!0)})),remove:async e=>new Promise((async(t,a)=>{if(e){let t=await(await j.open()).transaction(j.db_name,"readwrite").objectStore(j.db_name);if(e.length>0&&"object"==typeof e)for(const a of e)if(typeof u.Local[a]<"u"||typeof u.Local[a]<"u"){let e={};e[a]={oldValue:u.Local[a]??u.Local[a]??null,newValue:null},await t.delete(s.AesEnCrypt(a)),typeof u.Local[a]<"u"&&delete u.Local[a],typeof u.Local[a]<"u"&&delete u.Local[a],window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:e}))}}t(!0)})),clear:async()=>new Promise((async(e,t)=>{await ce(j.db_name),window.location.reload(),e(!0)}))},customAddListener:(e,t,a)=>window.addEventListener(e,(e=>"function"==typeof t?t(e.detail,a):{detail:e.detail,namespace:a}))};typeof window<"u"&&(window.umut_storage=j.storage);const _e={storage:{local:j.storage,onChanged:{addListener:(e,t)=>j.customAddListener("localStorageOnChange",e,"Local")}},runtime:{id:null}};let F=oe;typeof chrome<"u"&&(F=chrome??F);let re="aitopia.ai";const W=[re,"chatgptextension.ai"];let J=location.hostname.split(".");var le;J.length>2&&(delete J[0],J=Object.values(J)),J=J.join(".");const z=(null==(le=null==F?void 0:F.runtime)?void 0:le.id)??null;var E=z?`chrome-extension://${z}`:"";E+="/";var P=W[W.indexOf(J)]??W[0];const Z="chat.";let me=!1,M=P;P&&(P.split(".").length>2&&(delete(P=P.split("."))[0],P=Object.values(P).join(".").toString()),M=P,-1===P.indexOf("chatgptextension")&&-1===P.indexOf("extension://")&&(M=Z+M));let ye=["production_beta","development_beta_api"];const ae=-1!==ye.indexOf("production")?"beta_api":"extensions",N="src/html",g={domain:P,domain_allows:W,runtime_id:z??null,build_type:"self",main_dir:N,site:`https://${M}`,site_buy_plan:`https://${M}/subscription`,site_payment:`https://${M}/payment`,site_pricing:`https://${M}/pricing`,terms_conditions:`https://${M}/terms-conditions`,privacy_policy:`https://${M}/privacy-policy`,login:`https://${M}/auth`,login_prefix:`https://${M}/auth?logout`,profile:`https://${M}/app/profile`,api_mode:ae,api_url:`https://${ae}.${P}`,download_url:`https://download.${P}`,cdn_url:`https://cdn.${P}`,web_app_prefix:Z,web_app:`https://${Z}${re}`,extension_pricing:`${E}${N}/pricing.html`,extension_payment_success:`${E}${N}/payment_success.html`,extension_google_page:"https://chromewebstore.google.com/detail/chatgpt-sidebar-gpt-4-vis/becfinhbfclcgokjlobojlnldbfillpf",extension_id:z,manuel_extension_id:"becfinhbfclcgokjlobojlnldbfillpf",extension_dir:`${E}`,extension_main_dir:`${E}${N}`,lang_cache_type:"Local",debugMode:0,version:"6.4.0",app_name:"AITOPIA",app_title:"Chat with all AI models (Gemini, Claude, DeepSeek…) & AI Agents | AITOPIA",app_description:"AI Agent Marketplace & AI Sidebar with all AI models (Gemini, Claude, DeepSeek & more) and hundreds of AI Agents",app_search_title:"AITOPIA Sidebar",app_logo:"aitopia.svg",app_logo_full:null,app_install:!0,app_uninstall:!0,app_campaign_page:!1,app_context:!0,app_main_color:null,app_main_color_dark:null,app_main_link_color:null,app_main_link_color_dark:null,app_store_url:null,build_finish:!1,mode:"production",debug_time:"",web_access_search_limit:5,ai_default_model:"AITOPIA",image_upscaling_id:"image-upscaling",console_data:[],hello_world_test:"function helloWorld(args){if (!args)return false;}function testing(args){if (args)return true;}",disallow_pages:["accounts.google.com"],is_web_app:me,search_pages:{"www.google.com/search":{selector:'body textarea[type="search"],body textarea[aria-label="search"],body textarea[name="q"]',container:"#rhs",empty_selector:"#rcnt",empty_selector_position:"#center_col",empty_element:'<div class="TQc1id rhstc4" jscontroller="cSX9Xe" data-pws="1300" data-spe="true" jsaction="rcuQ6b:npT2md" id="rhs" jsdata="MdeVKb;_;A38Ny0" role="complementary" data-hveid="CAEQAA"></div>'},"www.yandex.com/search":{selector:'body [role="search"] [name="text"]',container:"#search-result-aside",empty_selector:".main__content > div",empty_selector_position:"",empty_element:'<div class="content__right content__right_cols_12" id="search-result-aside" data-log-node="2_apy0w00g" tabindex="-1"><div class="serp-list serp-list_right_yes"></div></div>'},"www.bing.com/search":{selector:'body [role="search"] [type="search"],body [role="search"] .b_searchbox',container:"#b_context",empty_selector:"#b_content > aside:first-child",empty_selector_position:"",empty_element:'<ol id="b_context"></ol>'},"www.duckduckgo.com":{selector:'body #search_form_input, body #search_form > input[type="text"]',container:'#web_content_wrapper [data-testid="sidebar"]',empty_selector:"",empty_selector_position:"",empty_element:'<section data-testid="sidebar" data-area="sidebar"></section>'},"search.yahoo.com/search":{selector:'body [role="search"] input[type="text"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.baidu.com/s":{selector:'#form [name="wd"],#form #kw',container:"#container #content_right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.ask.com/web":{selector:'[name="searchBoxContainer"] [name="q"]',container:"main .l-right-container",empty_selector:"",empty_selector_position:"",empty_element:""},"search.aol.com":{selector:'[role="search"] [name="q"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""}},ai_reply:{"mail.google.com":{reply_button:".ams.bkH",button:".amn",container:'[role="listitem"]:last-child',alternative_container:'[role="listitem"]:last-child',edit_container:'[role="listitem"] .editable',reply_insert_container:".Am.Al.editable.LW-avf",dot_position:{bottom:"25%",left:"85%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".gD[email]",mode:"attribute",type:"email"},{name:"sender_name",selector:".gD[name]",mode:"attribute",type:"name"},{name:"receiver_email",selector:".g2[email]",mode:"attribute",type:"email"},{name:"receiver_name",selector:".g2[name]",mode:"attribute",type:"name"},{name:"email_content",selector:".a3s > *",mode:"simple",type:"innerText"}]},"outlook.live.com":{reply_button:".th6py button:first-child",button:".Jj1JU,.th6py",container:'[role="document"][aria-expanded="true"]',alternative_container:'[role="document"][aria-expanded]',edit_container:'[id*="editorParent_"] [role="textbox"][contenteditable="true"]',reply_insert_container:"[id*='editorParent_'] [contenteditable=\"true\"] > *:first-child",dot_position:{bottom:"50%",left:"80%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"sender_name",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"receiver_email",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"receiver_name",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"email_content",selector:'[role="document"][aria-expanded="true"] [id*="UniqueMessageBody_"] div',mode:"simple",type:"innerText"}]},"mail.yandex.com":{reply_button:".qa-QuickReplyPlaceholder",button:".ns-view-toolbar-buttons .ns-view-container-desc",container:".mail-Layout-Content",alternative_container:".qa-MessageViewer article:last-child",edit_container:'[role="presentation"] [role="textbox"]',reply_insert_container:'[role="presentation"] [role="textbox"] div',dot_position:{bottom:"25%",left:"75%"},detail_elements:[{name:"history",selector:".qa-MessageViewer article",mode:"simple",type:"textContent"},{name:"sender_email",selector:".qa-MessageViewer-SenderEmail",mode:"attribute",type:"title"},{name:"sender_name",selector:".qa-MessageViewer-SenderName",mode:"attribute",type:"title"},{name:"receiver_email",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"receiver_name",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"email_content",selector:".qa-MessageViewer article",mode:"simple",type:"innerText"}]}},ai_reply_data:{},click_open_url:{"aitopia-pricing":"extension_pricing","aitopia-full-screen-page":`${E}${N}/full_screen.html`,"aitopia-login":"login","aitopia-login-prefix":"login_prefix","aitopia-subscription":"site_buy_plan","aitopia-profile":"profile","aitopia-g-extension":"extension_google_page","aitopia-options":`${E}${N}/options.html`,"aitopia-options-search":`${E}${N}/options.html?mode=search`,"aitopia-contact":`${E}${N}/options.html?mode=contact`,"aitopia-options-yt":`${E}${N}/options.html?mode=youtube`,"aitopia-terms":"terms_conditions","aitopia-privacy":"privacy_policy"},aspect_rations:[{value:"21 : 9",tooltipText:"1536 x 640",width:"1536",height:"640"},{value:"16 : 9",tooltipText:"1344 x 768",width:"1344",height:"768"},{value:"3 : 2",tooltipText:"1216 x 832",width:"1216",height:"832"},{value:"5 : 4",tooltipText:"1152 x 896",width:"1152",height:"896"},{value:"1 : 1",tooltipText:"1024 x 1024",width:"1024",height:"1024"},{value:"4 : 5",tooltipText:"896 x 1152",width:"896",height:"1152"},{value:"2 : 3",tooltipText:"832 x 1216",width:"832",height:"1216"},{value:"9 : 16",tooltipText:"768 x 1344",width:"768",height:"1344"},{value:"9 : 21",tooltipText:"640 x 1536",width:"640",height:"1536"}],styles:[{name:"None",style:"none",icon:`${E}/assets/images/image_chat/default.png`},{name:"Anime",style:"anime",icon:`${E}/assets/images/image_chat/anime.png`},{name:"Photographic",style:"photographic",icon:`${E}/assets/images/image_chat/photographic.png`},{name:"Digital Art",style:"digital-art",icon:`${E}/assets/images/image_chat/digital_art.png`},{name:"Comic Book",style:"comic-book",icon:`${E}/assets/images/image_chat/comic_book.png`},{name:"Fantasy Art",style:"fantasy-art",icon:`${E}/assets/images/image_chat/fantasy_art.png`},{name:"Line Art",style:"line-art",icon:`${E}/assets/images/image_chat/line_art.png`},{name:"Analog Film",style:"analog-film",icon:`${E}/assets/images/image_chat/analog_film.png`},{name:"Neon Punk",style:"neon-punk",icon:`${E}/assets/images/image_chat/neon_punk.png`},{name:"Isometric",style:"ısometric",icon:`${E}/assets/images/image_chat/isometric.png`},{name:"Low Poly",style:"low-poly",icon:`${E}/assets/images/image_chat/low_poly.png`},{name:"Origami",style:"origami",icon:`${E}/assets/images/image_chat/origami.png`},{name:"Cinematic",style:"cinematic",icon:`${E}/assets/images/image_chat/cinematic.png`},{name:"3D Model",style:"3d-model",icon:`${E}/assets/images/image_chat/three_d_model.png`},{name:"Pixel Art",style:"pixel-art",icon:`${E}/assets/images/image_chat/pixel_art.png`}],tools:[{id:1,name:"Remove Background",description:"Extract the main subject from a image with incredible accuracy.",video:`${E}assets/videos/remove-background-demo.mp4`,actionCode:"remove-background"},{id:2,name:"Remove Text",description:"Remove text from any image.",video:`${E}assets/videos/remove-text-demo.mp4`,actionCode:"remove-text"},{id:3,name:"Upscale",description:"Upscale your image by 2× or 4× with in seconds.",video:`${E}assets/videos/Enhance.webm`,actionCode:"image-upscaling"},{id:4,name:"Replace Background",description:"Teleport anything, any where with AI.",video:`${E}assets/videos/ReplaceBackground.webm`,actionCode:"replace-background"}],editTools:[{credit:1,id:"image-upscaling",image:!0,mask:!1,name:"Image Upscaling",prompt:!1,size:!0,explanation:"Select image magnification:",sectionWidth:90},{credit:1,id:"reimagine",image:!0,mask:!1,name:"Variation",prompt:!1,size:!1,explanation:null,sectionWidth:null},{credit:4,id:"remove-background",image:!0,mask:!1,name:"Remove Background",prompt:!1,size:!1,explanation:"Remove background from this image",sectionWidth:65},{credit:4,id:"remove-text",image:!0,mask:!1,name:"Remove Text",prompt:!1,size:!1,explanation:"Remove all text from the image",sectionWidth:60},{credit:6,id:"replace-background",image:!0,mask:!1,name:"Replace Background",prompt:!0,size:!1,explanation:null,sectionWidth:90}],pinnedContextPrompts:{reading:[42,43],writing:[45,56]},contextBlacklist:{"www.google.com":{selectors:["textarea[role='combobox']"]}},ExtensionBrowser:F??chrome??{},Browser:z?F??chrome??{}:_e,api_call_try:0,api_call_max_try:4,reply_prompts:{getEmailIntent:64,getEmailKeyPoints:65,getRelatedSuggestions:66,askAiReply:63},default_prompt_settings:{format:{model:"model_settings.format.items",label_before:"model_settings.format.html",label:"model_settings.format.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.format",default:"essay",type:"radio"},tone:{model:"model_settings.tone.items",label_before:"model_settings.tone.html",label:"model_settings.tone.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.tone",default:"formal",type:"radio"},length:{model:"model_settings.length.items",label_before:"model_settings.length.html",label:"model_settings.length.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.length",default:"short",type:"radio"},lang:{model:"storage.Local.languages",no_translate:!0,model_element:"title",model_prefix:"name",model_default:"settings.language_detail.name",type:"select",label:"Language"}},pageReadOptions:[{id:"summarize",label:"Summarize",prompt:"Please provide a concise summary of the following content:",description:"Get a brief overview of the main points and key takeaways",requireNavigateTo:"chat"},{id:"concepts",label:"Clarify key concepts",prompt:"Please identify and explain the key concepts from the following content:",description:"Break down complex ideas and terminology into simpler explanations",requireNavigateTo:"chat"},{id:"assumptions",label:"Identify Assumptions",prompt:"Please identify and explain the underlying assumptions in the following content:",description:"Uncover implicit beliefs and premises that shape the content",requireNavigateTo:"chat"},{id:"author",label:"Learn about author",prompt:"Please analyze and explain what we can learn about the author from the following content:",description:"Analyze writing style, perspective, and potential background of the author",requireNavigateTo:"chat"},{id:"keypoints",label:"Key Points",prompt:"Please identify and explain the key points from the following content:",description:"Extract and explain the most important arguments and evidence",requireNavigateTo:"chat"},{id:"related_news",label:"Find related news",prompt:"Please suggest and find relevant news articles from web related to the main topics in this content:",description:"Discover current news articles and updates on similar topics",requireNavigateTo:"web_search",search_prefix:"related news"},{id:"related_videos",label:"Watch related videos",prompt:"Please suggest relevant videos and documentaries that would complement or expand upon the topics in this content only prefer youtube videos:",description:"Find educational videos and documentaries to deepen understanding",requireNavigateTo:"web_search",search_prefix:"related youtube videos"}],scroll_tolerance:200},C={switchbar:"chat",color_mode:"auto",ai_mode:"local",ai_key:null,language:we(),language_name:null,language_detail:{},send_cmd:"enter",sidebar_cmd:"ctrl+y",color_mode_cmd:"ctrl+shift+l",fullscreen_cmd:"ctrl+shift+f",sidebar_show_icon:!0,sidebar_position:"right",sidebar_space:"overlay",search:!0,search_ask_mode:"manuel",youtube:!0,youtube_summarize_mode:"always",ai_model:g.ai_default_model,web_access:!1,context_reading:!0,context_reading_show_cmd:"ctrl",context_menu_shortcut_cmd:"ctrl+j",context_writing:!0,context_writing_input:!0,email_assistant:!0,speech_send:"always",voice_id:null,chat_controls:!0,capabilities:{web_search:!1,web_crawl:!1,image_generation:!1,data_analysis:!1,think:!1,artifacts:!1,task_progress:!1}};function we(){try{let e=navigator.language||(navigator.userLanguage??"en");return-1!=e.indexOf("-")&&(e=e.split("-")[0]),-1!=e.indexOf("_")&&(e=e.split("_")[0]),e}catch{return"en"}}class be{marked;count;constructor(){this.marked=new de(pe({langPrefix:"hljs language-",highlight(e,t,a){const n=ne.getLanguage(t)?t:"plaintext";return ne.highlight(e,{language:n}).value}})),this.marked.Renderer.prototype.paragraph=e=>"string"==typeof e?e+"\n":e.text+"\n",this.marked.Renderer.prototype.link=({href:e,title:t,text:a})=>{let n="";typeof t<"u"&&(n='title="'+t+'" ');let i="";typeof e<"u"&&(i='href="'+e+'" ');let o="";-1!==e.indexOf("://")&&(o='target="_blank" ');let l=s.filenameByType(e);return"image"==l?`<a ${o} ${i} ${n} class="ait-no-underline ait-flex ait-max-h-auto ait-max-w-xs"><img src="${e}" class="ait-max-h-auto ait-max-w-xs ait-border-[var(--ait-link-color)] ait-border ait-border-4 ait-rounded" ${n}/></a>`:"video"==l?`<video controls class="ait-border-[var(--ait-link-color)] ait-border ait-border-4 ait-rounded ait-max-h-auto ait-max-w-xs"> <source src="${e}">Your browser does not support the video tag. </video>`:"audio"==l?`<audio controls class="ait-max-h-auto ait-max-w-xs"> <source src="${e}">Your browser does not support the video tag. </audio>`:`<a ${o} ${i} ${n} > ${a} </a>`},this.marked.Renderer.prototype.table=e=>{let t="",a="";for(let s=0;s<e.header.length;s++)a+=this.marked.Renderer.prototype.tablecell(e.header[s]);t+=this.marked.Renderer.prototype.tablerow({text:a});let n="";for(let s=0;s<e.rows.length;s++){const t=e.rows[s];a="";for(let e=0;e<t.length;e++)a+=this.marked.Renderer.prototype.tablecell(t[e]);n+=this.marked.Renderer.prototype.tablerow({text:a})}return n&&(n=`<tbody>${n}</tbody>`),'<div class="ait-responsive-table"><table>\n<thead>\n'+t+"</thead>\n"+n+"</table></div>\n"},this.marked.Renderer.prototype.tablerow=({text:e})=>`<tr>\n${e}</tr>\n`,this.marked.Renderer.prototype.tablecell=e=>{const t=this.marked.parseInline(e.text),a=e.header?"th":"td";let n="vertical-align: top;",s="ait-min-w-[55px] ait-p-2";return(e.align?`<${a} align="${e.align}" style="${n}" class="${s}">`:`<${a}  style="${n}" class="${s}">`)+t+`</${a}>\n`}}pretty(e,t=!0){if(null===e||typeof e>"u"||"object"==typeof e||"function"==typeof(e=e.toString()).indexOf&&-1!==e.indexOf("hljs language"))return e;let a;function n(e){let t=e.match(/\*\*(.*?)\*\*/g);return t&&t.forEach((t=>{let a=t.replace(/\*\*/g,"");a="<strong>"+a+"</strong>",e=e.replace(new RegExp(s.RegexSpecialFixer(t),"g"),a)})),e}return n(t?this.marked.parseInline(this.marked.parse(e.replace(/^[\u200B\u200C\u200D\u200E\u200F\uFEFF]/,""),a).toString()).toString():this.marked.parse(e.replace(/^[\u200B\u200C\u200D\u200E\u200F\uFEFF]/,""),a).toString())}objectToBlockquotes(e,t=0){return null==e?"":"```json\n"+JSON.stringify(e)+"```"}}const ve=new be,K=ge(),k={emit:(e,t)=>K.emit(e,t),on:(e,t)=>K.on(e,t),off:(e,t)=>K.off(e,t)},se={QUESTION:{START:"<a href='javascript:;' class=\"ait-action-question\">",END:"</a>"},SUGGESTION:{START:"<a href='javascript:;' class=\"ait-action-suggestion\">",END:"<span>→</span></a>"}},Se={last_stream:"",async streamFormatter(e,t){this.last_stream=this.last_stream+(new TextDecoder).decode(e,{stream:!0}).toString();let a=this.last_stream,n=a.toString();if(a=a.replace(/"data":\{/gi,'"data": {').replace(/data:\{/gi,"data: {").replace(/"error":\{/gi,'"error": {').replace(/error:\{/gi,"error: {").replace(/\r/,"\n"),typeof a.match>"u")return{done:!0,loading:!1,content:"",error:"Invalid stream data"};const i=a.match(/(\w+): \{(.*)\}/gi);if(t)return this.last_stream="",{done:!0,loading:!1,content:"",finished:!0};let o=null,l={done:!1,loading:!0,content:"",role:null,error:null,events:null,finish_reason:null,is_finish_text:!1,artifacts:null,task_plan:null,task_progress_updates:null};if(null==i&&!t&&(o=s.JsonParse(a),s.notUndefined(o,"error")))return l.loading=!1,l.content=s.notUndefined(o,"error.message"),l.role="error",l.error=o.error,this.last_stream="",l;if("object"!=typeof i||null===i||!i){if(l.loading=!1,o=s.JsonParse(a),null!==o){let e=s.notUndefined(o,"choices.0.delta")??s.notUndefined(o,"choices.0"),t=s.notUndefined(e,"content")??s.notUndefined(e,"message"),a=s.notUndefined(e,"role");if(s.notUndefined(o,"event_type")&&s.notUndefined(o,"metadata")){let e=this.eventStreamBuilder(o);s.notUndefined(e,"id")&&(l.events=l.events||{},l.events[e.id]=e)}a&&t&&e&&(l.content=t.toString(),l.role=a)}return this.last_stream="",l}let r=n.split(/(\w+): (.*)$/gm),c="",u={},d=null,g=!1,p=[],_=[],m=null;if(r)for(const h of r)if(h&&typeof h<"u"){let e=h,t=s.JsonParse(h.trim());if("object"==typeof t){if("task_progress"===t.subtype&&t.task_id&&t.step_id)_.push({step_id:t.step_id,status:t.status,percent:t.percent,detail:t.detail,label:t.label});else if("task_plan"===t.subtype||t.task_id&&t.steps){let e=t.steps;e&&"object"==typeof e&&!Array.isArray(e)?e=Object.values(e):e||(e=[]),m={taskId:t.task_id,title:t.title||"Task Progress",steps:e}}if(t.id&&t.title&&t.content&&"data"===t.type){t.content.includes("\\n")&&!t.content.includes("\n\n")&&(t.content=t.content.replace(/\\n/g,"\n").replace(/\\t/g,"\t"));let e=t.language,a="code";if(!e&&t.content){const n=t.content.trim();n.startsWith("<!DOCTYPE html")||n.startsWith("<html")?(e="html",a="html"):n.startsWith("<svg")?(e="svg",a="svg"):n.startsWith("#")||n.includes("##")?(e="markdown",a="markdown"):e=t.content.includes("function")||t.content.includes("const ")||t.content.includes("let ")?"javascript":t.content.includes("def ")||t.content.includes("import ")?"python":"text"}else e&&("html"===e.toLowerCase()?a="html":"svg"===e.toLowerCase()?a="svg":("markdown"===e.toLowerCase()||"md"===e.toLowerCase())&&(a="markdown"));const n={id:t.id,type:a,title:t.title,content:t.content,language:e},s=t.title.toLowerCase(),i=s.includes("final")||s.includes("complete")||s.includes("combined")||s.includes("full"),o="html"===a&&(n.content.includes("<!DOCTYPE html")||n.content.includes("<html")&&n.content.includes("</html>")),l=p.length>0&&"html"===p[0].type&&(p[0].content.includes("<!DOCTYPE html")||p[0].content.includes("<html"));i||o?p=[n]:l&&!o||(0===p.length||n.content.length>p[0].content.length)&&(p=[n])}const e=this.parseStreamData(t);if(e.is_finish_text?(c=e.content||"",g=!0):e.content&&(c+=e.content||""),e.events&&(u={...u,...e.events}),e.finish_reason&&(d=e.finish_reason),e.finish_text_artifact){const t=e.finish_text_artifact;if(0===p.length)p=[t];else{const e=p[0],a=t.content.includes("<!DOCTYPE html");e.content.includes("<!DOCTYPE html"),a&&t.content.length>e.content.length&&(p=[t])}}}else if("{"==e.substring(0,1)&&"}"==e.substring(e.length-1,e.length)){let t=s.JsonParse(e.trim());if(t.id&&t.title&&t.content&&t.language){t.content.includes("\\n")&&!t.content.includes("\n\n")&&(t.content=t.content.replace(/\\n/g,"\n").replace(/\\t/g,"\t"));let e="code";const a=t.language.toLowerCase();"html"===a?e="html":"svg"===a?e="svg":("markdown"===a||"md"===a)&&(e="markdown");const n={id:t.id,type:e,title:t.title,content:t.content,language:t.language},s=t.title.toLowerCase(),i=s.includes("final")||s.includes("complete")||s.includes("combined")||s.includes("full"),o="html"===e&&(n.content.includes("<!DOCTYPE html")||n.content.includes("<html")&&n.content.includes("</html>")),l=p.length>0&&"html"===p[0].type&&(p[0].content.includes("<!DOCTYPE html")||p[0].content.includes("<html"));i||o?p=[n]:l&&!o||(0===p.length||n.content.length>p[0].content.length)&&(p=[n])}const a=this.parseStreamData(t);if(a.is_finish_text?(c=a.content,g=!0):a.content&&(c+=a.content||""),a.events&&(u={...u,...a.events}),a.finish_reason&&(d=a.finish_reason),a.finish_text_artifact){const e=a.finish_text_artifact;if(0===p.length)p=[e];else{const t=p[0];e.content.includes("<!DOCTYPE html")&&e.content.length>t.content.length&&(p=[e])}}}}return l.content=c,l.is_finish_text=g,Object.keys(u).length>0&&(l.events=u),d&&(l.finish_reason=d),p.length>0&&(l.artifacts=p,console.log("Artifacts in result",p.length)),m&&(l.task_plan=m,console.log("Task plan in result",m.title)),_.length>0&&(l.task_progress_updates=_,console.log("Task progress updates in result",_.length)),p.length>0&&p[0],""!=c&&null!=c&&(this.last_stream=""),l},parseStreamData(e){let t={content:"",role:null,error:null,events:null,finish_reason:null,is_finish_text:!1,task_plan:null,task_progress:null,finish_text_artifact:null};if(s.notUndefined(e,"error.message"))return t.content=s.notUndefined(e,"error.message"),t.role="error",t.error=e.error,t;let a=s.notUndefined(e,"choices.0.delta"),n=s.notUndefined(a,"content")??"",i=s.notUndefined(e,"choices.0.finish_reason")??null;if(s.notUndefined(e,"event_type")&&s.notUndefined(e,"metadata")){e.event_type,e.action;let a=this.eventStreamBuilder(e);s.notUndefined(a,"id")&&(t.events={},t.events[a.id]=a)}if(t.content=n.toString(),s.notUndefined(e,"finish_text")){let a=s.notUndefined(e,"finish_text");if(a&&"string"==typeof a){a.includes("\\n")&&!a.includes("\n\n")&&(a=a.replace(/\\n/g,"\n").replace(/\\t/g,"\t"));let e=null;const n=a.indexOf("<!DOCTYPE html"),s=[];let i=0;for(;;){const e=a.indexOf("</html>",i);if(-1===e)break;s.push(e),i=e+7}if(n>=0&&s.length>0){let i=-1;for(const e of s){const t=a.substring(n,e+7);if(t.includes("</head>")&&t.includes("</body>")){i=e;break}}-1===i&&(i=s[0]);let o=a.substring(n,i+7);const l=undefined;let r="",c="",u=!0;const d=a.substring(i+7).split("\n");for(const e of d){const t=e.trim();if(t){if(/^[A-ZİÇŞĞÜÖ][a-zçşğüöı][\s\S]{20,}/.test(t)||t.startsWith("```")||t.startsWith("###")||t.includes("sandbox:"))break;u&&/^(const|let|var|function|class|document\.|window\.)/.test(t)&&(u=!1),u&&/[a-z-]+\s*[:{}]/.test(t)?r+=(r?"\n":"")+t:u||(c+=(c?"\n":"")+t)}}if(o=o.replace(/<link[^>]*>/gi,""),o=o.replace(/<script[^>]*src[^>]*><\/script>/gi,""),o=o.replace(/<img[^>]*src=["'](?!http|data:)[^"']*["'][^>]*>/gi,""),r&&o.includes("</head>")){const e=o.indexOf("</head>"),t=`\n<style>\n${r}\n</style>\n`;o=o.substring(0,e)+t+o.substring(e)}if(c&&o.includes("</body>")){const e=o.lastIndexOf("</body>"),t=`\n<script>\n${c}\n<\/script>\n`;o=o.substring(0,e)+t+o.substring(e)}const g=`artifact_finish_html_${Date.now()}`;t.finish_text_artifact={id:g,type:"html",title:"Generated HTML",content:o,language:"html"},e=o}if(a=a.replace(/<!DOCTYPE html>[\s\S]*<\/html>/gi,"").trim(),e){const t=e.length>8e3,n=undefined,s=/```(?:html)?\s*\n?\s*```/i,i=`\n\`\`\`html\n${e.slice(0,8e3)+(t?"\n\n\x3c!-- …truncated. Use View Artifacts / Download for full HTML. --\x3e":"")}\n\`\`\``;s.test(a)?a=a.replace(s,i.trim()):a.length<5e3&&(a=(a?a+"\n\n":"")+i.trim())}const o=a.split("\n");o.length>100&&o[0].includes("<")&&(a="")}t.content=a,t.role="error"===s.notUndefined(e,"type")?"error":"system",t.is_finish_text=!0}return i&&null!==i&&(t.finish_reason=i),t},eventStreamBuilder(e){let t={};if(s.notUndefined(e,"event_type")&&s.notUndefined(e,"metadata")){let a=s.notUndefined(e,"metadata");typeof a.parameters<"u"&&delete a.parameters,t=a,t.event_type=s.notUndefined(e,"event_type"),t.event_data=s.notUndefined(e,"event_data"),t.action=s.notUndefined(e,"action"),t.created=s.notUndefined(e,"created"),t.id=s.notUndefined(e,"id")}return t}};console.time();const X={chats:{},ai_all_response:{},ai_response:[],instance:null,aborting:{},long_prefix:"<#Finished#>",count:0,extra_key:null,expires:{},ai_wait:!1,prompt_prefix:"##",last_stream:"",is_group_chat:!1,uuid_extra_data:{},debounceTimeout:null,chat_selected_agent:null,pendingUpdates:new Map,debounce(e,t){let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}},async processPendingUpdates(e,t){if(!this.pendingUpdates.has(`${e}-${t}`))return;const a=this.pendingUpdates.get(`${e}-${t}`);this.pendingUpdates.delete(`${e}-${t}`),a&&a.length&&(await this.setDataStorage(t,e),s.scrollToBottom())},queueUpdate(e,t,a,n){const s=`${e}-${t}`;this.pendingUpdates.has(s)||this.pendingUpdates.set(s,[]);const i=this.pendingUpdates.get(s);i&&(i.push({content_index:a,content:n}),this.debounce((()=>this.processPendingUpdates(e,t)),150)())},async chat(e="",t=null,a="ai_chat",n="__all",i=!1,o=!1,l=null,r=!1,c={},u=!1,d=0,p,_){var m,h;if(this.ai_wait)return;typeof this.aborting[n]<"u"&&(this.aborting[n]=null);let f=await s.Browser().storage.local.get(["settings","credit_detail","expires","ai_image_url","ai_chat_ids","context_data","selected_agent",a]);if(this.chat_selected_agent=s.notUndefined(f,"selected_agent"),await s.Browser().storage.local.set({ai_ask:null}),s.notUndefined(f,"context_data")&&(null==c||!c.mode)){const t=window.location.pathname,l=null==(m=f.context_data)?void 0:m.mode,r={chatwithfile:"chat_with_file.html"};l&&r[l]&&t.endsWith(r[l])&&(null!=(h=f.context_data)&&h.contextData&&(e=`##HIDDEN_CONTEXT_START##${f.context_data.contextData.context}##HIDDEN_CONTEXT_END##`+e),a="ai_single",n=s.SHA1("chat_with_file"),i=!1,o=!1)}this.key_detail=await s.Browser().storage.local.get(["uuid_hopekey","uuid_search"]),this.settings=s.notUndefined(f,"settings"),null==t&&(t=g.ai_default_model);let y=this.settings.ai_image_model==t?"image":"text";null===t&&(t=this.settings.ai_model),this.waiting(!0),this.credit_detail=s.notUndefined(f,"credit_detail"),typeof this.ai_all_response[n]>"u"&&(this.ai_all_response[n]={}),typeof this.ai_all_response[n][a]>"u"&&(this.ai_all_response[n][a]=[]);let w=s.notUndefined(f,`${a}`);null!=typeof f.expires&&(this.expires=f.expires);let b={};"string"==typeof w?(b=JSON.parse(w),Object.keys(b).length>0&&Object.keys(b).forEach((e=>{typeof this.ai_all_response[e]>"u"&&(this.ai_all_response[e]={}),this.ai_all_response[e][a]=Object.values(b[e])}))):(b=w,null!=b&&("ai_chat"==a?this.ai_all_response[n][a]=Object.values(b):typeof b[n]<"u"&&(this.ai_all_response[n][a]=Object.values(b[n])))),"ai_single"==a&&1==i&&0==r&&typeof this.ai_all_response[n]<"u"&&typeof this.ai_all_response[n][a]<"u"&&(this.ai_all_response[n][a]=[],Object.keys(this.ai_all_response[n][a]).length),this.uuid_search=s.notUndefined(this.key_detail,"uuid_search"),this.hopekey=s.notUndefined(this.key_detail,"uuid_hopekey"),document.querySelector("#aitopia-container");let x=`${g.api_url}/ai/send`;if(null!=this.credit_detail){let e=t;if(this.settings.web_access&&(e="GPT-4o"),typeof this.credit_detail[e]<"u"&&this.credit_detail[e].balance<this.credit_detail[e].cost&&-999!=this.credit_detail[e].credit&&"api"!==this.settings.ai_mode)return this.ai_all_response[n][a].forEach(((e,t)=>{"limit"==e.role&&delete this.ai_all_response[n][a][t]})),this.ai_all_response[n][a]=Object.values(this.ai_all_response[n][a]),this.ai_all_response[n][a].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),await this.setDataStorage(a,n),void(await this.waiting(!1))}let v=this.ai_all_response[n][a],k=0,S=!1;Object.keys(this.ai_all_response[n][a]).length>0&&!s.notUndefined(c,"search")&&this.ai_all_response[n][a].forEach(((e,t)=>{k++,v!=k&&1==this.ai_all_response[n][a][t].loading&&(this.ai_all_response[n][a][t].loading=!1,S=!0),"limit"==e.role&&(delete this.ai_all_response[n][a][t],this.ai_all_response[n][a]=Object.values(this.ai_all_response[n][a]),S=!0)})),u&&(this.is_group_chat=!0,S=!0),S&&await this.setDataStorage(a,n);let E="";this.count++;let O="user";if("image"==y&&(O="image"),(null==c||"object"!=typeof c)&&(c={}),(String(e).trim().length>0||"image"==O)&&0==r&&(c.prompt_mode=o,0==d)){const s={item:e,role:O,model:t,title:l,loading:"image"==O,extra_data:c};_&&Array.isArray(_)&&_.length>0&&(s.attachments=_),this.ai_all_response[n][a].push(s)}"image"!=y&&null!=s.notUndefined(f,"ai_image_url")&&""!==s.notUndefined(f,"ai_image_url")&&typeof c.search_mode>"u"&&(this.settings.web_access=!1,c.ai_image_url=s.notUndefined(f,"ai_image_url"),await s.Browser().storage.local.set({ai_image_url:null}),await s.Browser().storage.local.remove(["ai_image_url"]));let U=s.ChatId(a,n);const C=p&&Array.isArray(p)&&p.length>0?p:void 0;let j={history:this.ai_all_response[n][a],text:e,model:t,stream:"image"!=y,uuid_search:this.uuid_search,mode:a,prompt_mode:o,extra_key:n,extra_data:c,chat_id:U,language_detail:this.settings.language_detail,is_continue:r};C&&C.length>0&&(j.file_ids=C);const L=this.settings.capabilities;L&&"object"==typeof L&&Object.values(L).some((e=>!0===e))&&(j.settings=L),this.uuid_extra_data={chat_id:j.chat_id,history:j.history,mode:a},this.settings.ai_key&&"api"==this.settings.ai_mode&&(j.token=this.settings.ai_key),this.settings.language&&(j.lang_code=this.settings.language);let T=this.ai_all_response[n][a].length;("image"==y||s.notUndefined(c,"search"))&&(T-=1),T<0&&(T=0);let B="";1==r&&this.ai_all_response[n][a].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="",T=t,E=B=e.item)})),this.ai_all_response[n][a].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="stop")})),"image"!=y&&(this.ai_all_response[n][a][T]={item:B,role:"system",model:t,loading:!0,title:l,extra_data:c}),await this.setDataStorage(a,n),this.aborting[n]=new AbortController;let A=document.querySelectorAll("#ait-stop-chat-"+a),$=document.querySelectorAll("#ait-stop-chat-"+a+" button");null!=$&&null!=A&&(A.forEach((e=>{e.classList.remove("ait-hide"),e.classList.add("ait-show")})),this.aborting[n].signal.addEventListener("abort",(()=>{"ai_single"==a?Object.values(this.ai_all_response[n][a]).length>0&&this.ai_all_response[n][a].forEach(((e,t)=>{this.ai_all_response[n][a][t].loading=!1,this.ai_all_response[n][a][t].stop=!0})):(this.ai_all_response[n][a][T].loading=!1,this.ai_all_response[n][a][T].stop=!0),this.setDataStorage(a,n),this.waiting(!1)})),Object.keys($).length>0&&$.forEach((e=>{e.onclick=e=>{this.aborting[n].abort(),this.waiting(!1);let t={force:1};this.is_group_chat&&(t.extra_data=this.uuid_extra_data),s.sendMessage("uuid",t),A.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")}))}})));let P=null;return await this.setDataStorage(a,n),-1!==["image"].indexOf(y)?await this.imageApi(a,t,n,j,T,A,P,x,E).finally((async()=>await this.waiting(!1))):1==s.notUndefined(this.settings,"web_access")&&-1===["image"].indexOf(t)&&0==r&&"__all"==n&&!s.notUndefined(c,"search")&&e.length<=2048&&0==o?(s.Browser().web_access_mode=a,s.Browser().web_access_extra_key=n,s.sendMessage("GoogleSearchCall",e,"GoogleSearchCallback","tabs")):(s.notUndefined(f,"selected_agent._listkey")&&!o&&(j.extra_data.agent_id=s.notUndefined(f,"selected_agent._listkey")),await this.aiApi(a,t,n,j,T,A,P,x,E,this).finally((async e=>{await this.waiting(!1)})))},async AiSync(e,t,a=g.ai_default_model,n){let i={history:e,text:t,model:a,stream:!1,uuid_search:this.uuid_search,mode:"ai_chat",prompt_mode:!1,extra_key:"__all",extra_data:n??{search_fixer:!0},chat_id:null,language_detail:this.settings.language_detail};return s.apiCall(`${g.api_url}/ai/send`,i,"POST",-1).then((e=>s.notUndefined(e,"choices.0.message.content")??null))},async imageApi(e,t,a,n,i,o,l,r,c){let u=n.extra_data.image_count??1;if(this.credit_detail[t]&&u*(this.credit_detail[t].cost??1)>this.credit_detail[t].balance&&-999!=this.credit_detail[t].credit&&"-999"!=this.credit_detail[t].credit)return this.ai_all_response[a][e].forEach(((t,n)=>{"limit"==t.role&&delete this.ai_all_response[a][e][n]})),this.ai_all_response[a][e][i].loading=!1,this.ai_all_response[a][e]=Object.values(this.ai_all_response[a][e]),this.ai_all_response[a][e].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),void(await this.setDataStorage(e,a));let d={role:"image",item:n.text,loading:!0,images:[]};this.ai_all_response[a][e][i]={...this.ai_all_response[a][e][i],...d},await this.setDataStorage(e,a);let g="/ai/image";return null!=n.extra_data.action&&(g="/ai/image_editing"),s.apiCall(g,n,"POST",-1).then((async r=>{let c=r;typeof c.images>"u"&&(c.images=[]),typeof c.seed>"u"&&(c.seed=null),d.images=c.images||[],d.loading=!1,d.seed=c.seed||null,this.ai_all_response[a][e][i]={...this.ai_all_response[a][e][i],...d},typeof c<"u"&&typeof c.message<"u"&&this.ai_all_response[a][e].push({item:c.message??null,role:c.type??"error",model:t,finish_reason:l,loading:!1}),await this.setDataStorage(e,a);let u={force:1};return this.is_group_chat&&(u.extra_data=this.uuid_extra_data),s.sendMessage("uuid",u),null!=o&&o.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),null!=n.extra_data.action&&s.Browser().storage.local.get("image_settings").then((e=>{e.image_settings.image=null,e.image_settings.action=null,s.Browser().storage.local.set(e)})),this.ai_all_response[a][e][i]})).catch((e=>{console.log(e)}))},async aiApi(e,t,a,n,i,o,l,r,c,u=this){let d=0;return s.notUndefined(this.ai_all_response,`${a}`)||(u.ai_all_response[a]={}),s.notUndefined(this.ai_all_response,`${a}.${e}`)||(u.ai_all_response[a][e]={}),s.notUndefined(this.ai_all_response,`${a}.${e}.${i}`)||(u.ai_all_response[a][e][i]={}),null===(this.hopekey??null)&&(this.key_detail=await s.Browser().storage.local.get(["uuid_hopekey","uuid_search"]),this.uuid_search=s.notUndefined(this.key_detail,"uuid_search"),this.hopekey=s.notUndefined(this.key_detail,"uuid_hopekey")),fetch(r,{headers:{accept:"text/plain",hopekey:this.hopekey||null},body:JSON.stringify(n),method:"POST",signal:this.aborting[a].signal}).then((async t=>{const n=t.body.getReader();let s=async()=>n.read().then((async({value:t,done:n})=>{if(await u.streamFormatter(t,n,a,e,i,d,u),d++,!n)return await s()})).catch((t=>{if(u.waiting(!1),t instanceof DOMException&&"AbortError"==t.name)return null!=document.querySelector(".ai_loading")&&document.querySelector(".ai_loading").classList.remove("ai_loading"),void(u.ai_all_response[a][e][i]._abort=!0);"network error"==t.message?(u.ai_all_response[a][e][i].loading=!1,u.ai_all_response[a][e][i]._error=JSON.stringify(t),console.log(t.message)):(u.ai_all_response[a][e][i].loading=!1,console.log(t.message,t.toString(),t),console.log(u.ai_all_response[a][e]),console.log(c??null),u.ai_all_response[a][e][i]._error=JSON.stringify(t)),u.setDataStorage(e,a)}));return await s()})).then((e=>{})).catch((t=>{this.waiting(!1),s.notUndefined(this.ai_all_response,`${a}.${e}.${i}`)&&(this.ai_all_response[a][e][i].loading=!1,this.ai_all_response[a][e][i].loading=!1);let n='<span class="ait-text-red-600">'+s.__("(Internet connection lost. Please try again)")+"</span>";null!=o&&o.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),c.length>0&&(n=c+"\n\n"+n),s.notUndefined(this.ai_all_response,`${a}.${e}.${i}`)&&(this.ai_all_response[a][e][i].item=n,u.ai_all_response[a][e][i]._error=JSON.stringify(t),this.setDataStorage(e,a)),console.log(t)}))},async setData(e,t,a=!0,n=this){let i={};return i[e]={},new Promise((async o=>{null===n.instance&&o(!1);let l=n.instance[e];"string"==typeof l&&null!=l&&(l=JSON.parse(l)),"__all"!=t&&null!=t&&"ai_chat"!=e&&a?(null!=l&&Object.keys(l).length>0&&Object.keys(l).forEach((t=>{i[e][t]=l[t]})),typeof n.ai_all_response[t]<"u"&&typeof n.ai_all_response[t][e]<"u"&&(i[e][t]=n.ai_all_response[t][e])):i[e]=n.ai_all_response[t][e];let r=await s.diagramDataBuilder(i,t,this.chat_selected_agent);r&&(i=Object.assign(r,i)),n.instance.storage&&n.instance.storage.Local&&(n.instance.storage.Local[e]=i[e]),n.instance[e]=i[e],n.instance.$root&&(n.instance.$root[e]=i[e]),n.instance.$data&&(n.instance.$data[e]=i[e]),o(i)}))},async setDataStorage(e,t,a=!0){let n={};return n[e]={},await s.Browser().storage.local.get(e).then((async i=>{let o=i[e];"string"==typeof o&&null!=o&&(o=JSON.parse(o)),"__all"!=t&&null!=t&&"ai_chat"!=e&&a?(null!=o&&Object.keys(o).length>0&&Object.keys(o).forEach((t=>{n[e][t]=o[t]})),typeof this.ai_all_response[t]<"u"&&typeof this.ai_all_response[t][e]<"u"&&(n[e][t]=this.ai_all_response[t][e]),Object.keys(this.ai_all_response).forEach((t=>{typeof this.ai_all_response[t][e]<"u"&&(n[e][t]=this.ai_all_response[t][e])}))):n[e]=this.ai_all_response[t][e];let l=await s.diagramDataBuilder(n,t,this.chat_selected_agent);return l&&(n=Object.assign(l,n)),await s.Browser().storage.local.set(n).then((async()=>await this.setData(e,t)))}))},async streamFormatter(e,t,a,n,i,o=0,l=this){const r=await Se.streamFormatter(e,t);if(r.artifacts&&Array.isArray(r.artifacts)&&r.artifacts.length>0){l.ai_all_response[a][n][i].extra_data||(l.ai_all_response[a][n][i].extra_data={}),l.ai_all_response[a][n][i].extra_data.artifacts||(l.ai_all_response[a][n][i].extra_data.artifacts=[]);const e=r.artifacts[0],t=l.ai_all_response[a][n][i].extra_data.artifacts;if(0===t.length)l.ai_all_response[a][n][i].extra_data.artifacts=[e];else{const s=t[0],o=e.title.toLowerCase(),r=o.includes("final")||o.includes("complete")||o.includes("combined")||o.includes("full"),c="html"===e.type&&(e.content.includes("<!DOCTYPE html")||e.content.includes("<html")&&e.content.includes("</html>")),u="html"===s.type&&(s.content.includes("<!DOCTYPE html")||s.content.includes("<html"));r||c?l.ai_all_response[a][n][i].extra_data.artifacts=[e]:u&&!c||e.content.length>s.content.length&&(l.ai_all_response[a][n][i].extra_data.artifacts=[e])}}if(r.content&&(r.is_finish_text?l.ai_all_response[a][n][i].item=r.content:l.ai_all_response[a][n][i].item+=r.content),r.role&&(l.ai_all_response[a][n][i].role=r.role),void 0!==r.loading&&(l.ai_all_response[a][n][i].loading=r.loading),r.events&&(l.ai_all_response[a][n][i].events||(l.ai_all_response[a][n][i].events={}),l.ai_all_response[a][n][i].events={...l.ai_all_response[a][n][i].events,...r.events}),r.task_plan){l.ai_all_response[a][n][i].task||(l.ai_all_response[a][n][i].task={plan:null,steps:[],status:"idle"});let e=r.task_plan.steps;e&&"object"==typeof e&&!Array.isArray(e)?e=Object.values(e):Array.isArray(e)||(e=[]),l.ai_all_response[a][n][i].task.plan={...r.task_plan,steps:e},l.ai_all_response[a][n][i].task.steps=e,l.ai_all_response[a][n][i].task.status="running",k.emit("task-plan",r.task_plan)}if(r.task_progress_updates&&r.task_progress_updates.length>0){l.ai_all_response[a][n][i].task||(l.ai_all_response[a][n][i].task={plan:null,steps:[],status:"running"});for(const e of r.task_progress_updates){let t=l.ai_all_response[a][n][i].task.steps;Array.isArray(t)||(t=t&&"object"==typeof t?Object.values(t):[],l.ai_all_response[a][n][i].task.steps=t);const s=t.findIndex((t=>t.id===e.step_id));s>=0?t[s]={...t[s],status:e.status||t[s].status,percent:e.percent,detail:e.detail,label:e.label||t[s].label}:t.push({id:e.step_id,label:e.label||e.step_id,status:e.status||"running",percent:e.percent,detail:e.detail}),k.emit("task-progress",e)}}if(r.task_progress&&!r.task_progress_updates){l.ai_all_response[a][n][i].task||(l.ai_all_response[a][n][i].task={plan:null,steps:[],status:"running"});let e=l.ai_all_response[a][n][i].task.steps;Array.isArray(e)||(e=e&&"object"==typeof e?Object.values(e):[],l.ai_all_response[a][n][i].task.steps=e);const t=e.findIndex((e=>e.id===r.task_progress.step_id));t>=0&&(e[t]={...e[t],status:r.task_progress.status||e[t].status,percent:r.task_progress.percent,detail:r.task_progress.detail,label:r.task_progress.label||e[t].label}),k.emit("task-progress",r.task_progress)}if(r.finish_reason&&(l.ai_all_response[a][n][i].finish_reason=r.finish_reason,k.emit("ai-finish")),r.error&&(l.ai_all_response[a][n][i]._error=JSON.stringify(r.error),k.emit("ai-error",r.error.message||r.error)),r.done||t){l.ai_all_response[a][n][i].loading=!1,await l.processPendingUpdates(a,n),await l.waiting(!1),await this.setDataStorage(n,a);let e={force:1};return l.is_group_chat&&(e.extra_data=l.uuid_extra_data),s.sendMessage("uuid",e),void s.scrollToBottom()}return r.content&&(l.queueUpdate(a,n,i,l.ai_all_response[a][n][i].item),k.emit("ai-stream",r.content)),o%10==0||1==o||r.events?(await l.setDataStorage(n,a),k.emit("ai-response",l.ai_all_response[a][n][i])):await l.setData(n,a),l.ai_all_response[a][n][i].item},eventStreamBuilder(e){let t={};if(s.notUndefined(e,"event_type")&&s.notUndefined(e,"metadata")){let a=s.notUndefined(e,"metadata");typeof a.parameters<"u"&&delete a.parameters,t=a,t.event_type=s.notUndefined(e,"event_type"),t.event_data=s.notUndefined(e,"event_data"),t.action=s.notUndefined(e,"action"),t.created=s.notUndefined(e,"created"),t.id=s.notUndefined(e,"id")}return t},async streamToResponseData(e,t,a,n,i=0,o=this){var l;if(e.artifacts&&Array.isArray(e.artifacts)){o.ai_all_response[t][a][n].extra_data||(o.ai_all_response[t][a][n].extra_data={}),o.ai_all_response[t][a][n].extra_data.artifacts||(o.ai_all_response[t][a][n].extra_data.artifacts=[]);const s=e.artifacts[0],i=o.ai_all_response[t][a][n].extra_data.artifacts;if(0===i.length)o.ai_all_response[t][a][n].extra_data.artifacts=[s];else{const e=i[0],l=s.title.toLowerCase(),r=l.includes("final")||l.includes("complete")||l.includes("combined")||l.includes("full"),c="html"===s.type&&(s.content.includes("<!DOCTYPE html")||s.content.includes("<html")&&s.content.includes("</html>")),u="html"===e.type&&(e.content.includes("<!DOCTYPE html")||e.content.includes("<html"));r||c?o.ai_all_response[t][a][n].extra_data.artifacts=[s]:u&&!c||s.content.length>e.content.length&&(o.ai_all_response[t][a][n].extra_data.artifacts=[s])}}if(s.notUndefined(e,"error.message"))return o.ai_all_response[t][a][n].loading=!1,o.ai_all_response[t][a][n].item=s.notUndefined(e,"error.message"),o.ai_all_response[t][a][n].role="error",k.emit("ai-error",s.notUndefined(e,"error.message")),await o.setDataStorage(a,t),await o.waiting(!1),o.ai_all_response[t][a][n].item;let r=s.notUndefined(e,"choices.0.delta"),c=s.notUndefined(r,"content")??"",u=s.notUndefined(e,"choices.0.finish_reason")??null;if(typeof o.ai_all_response[t]>"u"&&(o.ai_all_response[t]={}),typeof o.ai_all_response[t][a]>"u"&&(o.ai_all_response[t][a]=[]),typeof o.ai_all_response[t][a][n]>"u"&&(o.ai_all_response[t][a][n]={item:"",role:"",loading:!0}),s.notUndefined(e,"event_type")&&s.notUndefined(e,"metadata")){let i=this.eventStreamBuilder(e);typeof o.ai_all_response[t][a][n].events>"u"&&(o.ai_all_response[t][a][n].events={}),s.notUndefined(i,"id")&&(o.ai_all_response[t][a][n].events[i.id]=i)}if(typeof o.ai_all_response[t][a][n].item>"u"&&(o.ai_all_response[t][a][n].item=""),typeof c>"u"&&(c=""),console.log(c),o.ai_all_response[t][a][n].item+=c.toString(),g.debugMode&&console.log(s.notUndefined(e,"finish_text")),s.notUndefined(e,"finish_text"))return o.ai_all_response[t][a][n].item=s.notUndefined(e,"finish_text"),o.ai_all_response[t][a][n].role="error"===s.notUndefined(e,"type")?"error":"system",o.ai_all_response[t][a][n].prompt=s.notUndefined(e,"prompt"),o.ai_all_response[t][a][n].loading=!1,null==(l=o.ai_all_response[t][a][n].extra_data)||l.artifacts,await o.setDataStorage(a,t),await o.waiting(!1),o.ai_all_response[t][a][n].item;s.notUndefined(o.ai_all_response[t][a],`${n}.model`);let d=parseInt(s.notUndefined(e,"mod")??10);return isNaN(d)&&(d=10),u&&null!==u&&(o.ai_all_response[t][a][n].finish_reason=u,k.emit("ai-finish")),c&&k.emit("ai-stream",c),i%d==0||1==i||d<=1?(await o.setDataStorage(a,t),k.emit("ai-response",o.ai_all_response[t][a][n])):await o.setData(a,t),c},linkify:e=>null==e?"":ve.pretty(e)??e,waiting:async(e=!0)=>(k.emit("ai-loading",e),0==e?document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})):document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-show"),e.classList.remove("ait-hide")})),await s.Browser().storage.local.set({ai_wait:e}).then((()=>s.scrollToBottom()))),prefixify(e){if(null==e)return"";let t=this.prompt_prefix.toString();return"function"!=typeof(e=e.toString()).replace||Object.keys(se).forEach((a=>{let n=se[a];Object.keys(n).forEach((s=>{let i=n[s],o=new RegExp(`\n${t}${a}_${s}${t}\n`.toString(),"gi"),l=new RegExp(`\n${t}${a}_${s}${t}`.toString(),"gi"),r=new RegExp(`${t}${a}_${s}${t}\n`.toString(),"gi"),c=new RegExp(`${t}${a} ${s}${t}\n`.toString(),"gi"),u=new RegExp(`${t}${a}_${s}${t}`.toString(),"gi");e=e.replace(o,i).replace(l,i).replace(r,i).replace(c,i).replace(u,i).replace(/##HIDDEN_CONTEXT_START##.*##HIDDEN_CONTEXT_END##/gs,"")}))})),e},async testChat(e,t,a,n,s,i=10){for(let o=0;o<i;o++){typeof this.ai_all_response[t]>"u"&&(this.ai_all_response[t]={}),typeof this.ai_all_response[t][a]>"u"&&(this.ai_all_response[t][a]=[]),this.ai_all_response[t][a]=Object.values(this.ai_all_response[t][a]);let e="";this.ai_all_response[t][a][s]&&typeof this.ai_all_response[t][a][s].item<"u"&&(e=this.ai_all_response[t][a][s].item),this.ai_all_response[t][a][s]={item:e+"TEST"+(new Date).toDateString()+"____>"+o,role:"system",model:n},await this.setData(a,t)}},streamRegExBuilder:(e,t,a=!1)=>{let n=null;try{n=t.match(e)[0]??null,null!==n&&a&&(n=n.replace(/(data|error|event|ping|finish): /,""))}catch{n=null}return n},bulkPrettier:(e,t=!1)=>(console.log(e),e&&"object"==typeof e&&Object.keys(e).forEach((a=>{typeof e[a].item<"u"&&typeof e[a].is_prettier>"u"&&null!==e[a].item&&(e[a].item=X.prefixify(X.linkify(e[a].item)),t&&(e[a].item=e[a].item.replace(/\n/g,"<br>")))})),e)};class Q{static async setExpiry(e,t){if(!e||t<=0)console.error("Invalid key or hours parameter");else try{let a=(await s.Browser().storage.local.get("expires")).expires||{};const n=parseInt(Date.now().toString().substring(0,10))+3600*t;a[e]=n,await s.Browser().storage.local.set({expires:a}),console.log(`✓ Expiry set for '${e}': ${t} hours (${n})`)}catch(a){throw console.error("Error setting expiry:",a),a}}static async removeExpiry(e){if(e)try{let t=(await s.Browser().storage.local.get("expires")).expires||{};t[e]&&(delete t[e],await s.Browser().storage.local.set({expires:t}),console.log(`✓ Expiry removed for '${e}'`))}catch(t){throw console.error("Error removing expiry:",t),t}else console.error("Invalid key parameter")}static async getRemainingTime(e){if(!e)return null;try{const t=(await s.Browser().storage.local.get("expires")).expires||{};if(!t[e])return null;const a=parseInt(Date.now().toString().substring(0,10)),n=parseInt(t[e])-a;return n>0?n:0}catch(t){return console.error("Error getting remaining time:",t),null}}static async updateExpiry(e,t){return await this.setExpiry(e,t)}static async getExpiredKeys(){try{const e=(await s.Browser().storage.local.get("expires")).expires||{},t=parseInt(Date.now().toString().substring(0,10)),a=[];return Object.keys(e).forEach((n=>{parseInt(e[n])<t&&a.push(n)})),a}catch(e){return console.error("Error getting expired keys:",e),[]}}static async listAll(){try{const e=(await s.Browser().storage.local.get("expires")).expires||{},t=parseInt(Date.now().toString().substring(0,10)),a={};return Object.keys(e).forEach((n=>{const s=parseInt(e[n]),i=s-t;a[n]={expiryTime:s,remaining:i,expired:i<=0}})),a}catch(e){return console.error("Error listing all expiries:",e),{}}}}typeof window<"u"&&typeof document<"u"&&(window.getCookie=e=>{var t=[];if("*"==e){let e=document.cookie.split("; ").map((e=>e.split("=")))??[];return Object.fromEntries(e)}if(t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)")))return t[2]},window.setCookie=(e,t,a,n=null)=>{var s="";if(a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3),s="; expires="+i.toUTCString()}null==n&&(n=window.location.host,window.location.host.split(".").length>2&&(n="."+(n=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"="+(t||"")+"; "+s+"; path=/; domain="+n+"; secure; SameSite=None"},window.eraseCookie=(e,t=null)=>{null==t&&(t=window.location.host,window.location.host.split(".").length>2&&(t="."+(t=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"=null; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain="+t});class Oe{notify=ue.useToast({duration:5e3,position:"top"});resizeBorder=(e,t=320,a=null)=>{if(null==e)return;let n;e.classList,e.id;let s=document.createElement("div");s.classList.add("ai-el-resize"),e.append(s);const i=a=>{const s=n-a.x;n=a.x;let i=parseInt(getComputedStyle(e,"").width)+s;i>=t&&(e.style.width=`${i}px`)};return s.addEventListener("mousedown",(function(e){e.offsetX<t&&(n=e.x,document.addEventListener("mousemove",i,!1),a&&a(n))}),!1),document.addEventListener("mouseup",(function(e){document.removeEventListener("mousemove",i,!1)}),!1),n};fetchWithTimeout=(e,t={},a=6e4)=>{let n=null,s={...t};if(a>0){let e=new AbortController;n=setTimeout((()=>{e.abort(),clearTimeout(n)}),a),s.signal=e.signal}return fetch(e,s).then((function(e){return null!=n&&clearTimeout(n),e})).finally((()=>{null!=n&&clearTimeout(n)}))};NodeSearch=(e,t)=>[...e].filter((e=>-1!==e.outerHTML.indexOf(t)));logout=()=>this.apiCall("/auth/logout",{},"POST").finally((()=>(g.domain_allows.forEach((e=>{window.eraseCookie("hopekey","."+e),window.eraseCookie("ait_app","."+e),window.eraseCookie("aitopia_check_login","."+e)})),s.uuid(1).finally((()=>{this.notify&&this.notify.success(this.__("Successfully logged out."))})))));storageLocalClearAll=(e=!1)=>{let t=["token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","check_extension_expire","check_extension"];return 1==e&&(t=null),chrome.storage.local.get(t).then((e=>(g.debugMode&&console.log(e),s.Browser().storage.local.remove(Object.keys(e)))))};sendMessageWindowListener=(e,t,a)=>s.sendMessageListener(e,{},t);sendMessageListener=async(e,t,a,n=!1)=>{let i=[],o=null;if(typeof e.data<"u"&&(i=e.data),o=s.messageExecute(null,e.fn,i,!1,this),o&&"function"==typeof o.then&&n){let e=await o;e&&(o=e)}return null==a?{received:!0,return_data:o}:s.messageSendResponse(o,i,t,a)};sendMessage=(e,t={},a=null,n="scripting",i="runtime",o=null)=>{let l=null!=g.runtime_id?chrome??this.Browser()??{}:this.Browser(),r={fn:e,data:{data:t,callback:a,type:n}},c=e=>({received:!0,return_data:e});if(null===g.runtime_id&&!s.notUndefined(l[i],"sendMessage"))return s.onMessageExecutePre(r,{},c);if(!(typeof l[i]>"u"||typeof l[i].sendMessage>"u"))try{return l[i].sendMessage(o??l.runtime.id??null,r,c)}catch(u){return g.debugMode&&console.log(u),s.onMessageExecutePre(r,{},c)}};onMessageListener=()=>s.notUndefined(s.Browser().runtime,"onMessage")?s.Browser().runtime.onMessage.hasListener(s.onMessageExecutePre)?new Promise((e=>e(!1))):s.Browser().runtime.onMessage.addListener(s.onMessageExecutePre):new Promise((e=>e(!1)));onMessageExecutePre=(e,t,a)=>{let n=[],i=null;return s.notUndefined(e,"data")&&(n=e.data),i=s.messageExecute(null,s.notUndefined(e,"fn")??null,n),s.messageSendResponse(i,n,t,a)};messageExecute=(e,t,a,n=!1,i={})=>{let o=null,l=a;s.notUndefined(l,"data")&&(l=l.data);let r=[],c=["object","function"],u={};if(null!=self&&(u=self),null!=t&&"function"!=typeof t&&(r="string"==typeof t?t.split("."):t,null==e)){let e=[typeof i<"u"?i:null,typeof u<"u"?u:null,typeof this<"u"?this:null,typeof ServiceWorkerGlobalScope<"u"?ServiceWorkerGlobalScope:null,typeof s<"u"?s:null,s.notUndefined(this,"Browser")?this.Browser():null];if(typeof r.forEach<"u"&&r.forEach((t=>{if(null==o){if(-1!==c.indexOf(typeof t))o=this.messageExecute(null,t,l,n);else for(const a of e)if(null!=a&&s.notUndefined(a,t)&&-1!==c.indexOf(typeof a[t])){o=this.messageExecute(null,a[t],l,n);break}}else o=o[t]??null})),"function"!=typeof o)return o??null;t=o}if(null!=e){if("object"==typeof e[t]&&typeof e[t].then>"u"||!0===n)return e[t]}else if(!0===n)return t;if("object"==typeof t&&null!=t&&"function"==typeof t.then)return t();if(null==e&&"object"==typeof t)return t;try{return null==e&&"function"==typeof t?Array.isArray(l)?t(...l):t(l):null==e&&null!=t?t:"object"==typeof e&&"function"==typeof e[t]?Array.isArray(l)?e[t](...l):e[t](l):null==e?void 0:typeof e[t]<"u"&&typeof e[t].then>"u"&&"object"==typeof e?e:Array.isArray(l)?e[t](...l):e[t](l)}catch{return null==e&&"function"==typeof t?t():null==e&&null!=t?t:null==e?void 0:typeof e[t]<"u"&&"object"==typeof e&&"function"==typeof e[t]?e[t]():"object"==typeof e&&typeof e[t].then>"u"?e:e[t]()}};messageSendResponse=(e,t,a,n,i={})=>{let o=null,l=s.notUndefined(t,"type")??"scripting",r=s.notUndefined(t,"callback")??null;if(r){o=this.messageExecute(null,t.callback,e,!0,i);let a=o.name;t.callback=o,t.callback_name=a}if(null==e)return n({received:!0,return_data:e});if("object"==typeof e&&"function"==typeof e.then){let o;return n({received:!0,return_data:e.then((e=>{if(typeof e<"u"&&typeof e.text<"u"&&(e=e.text()),typeof e<"u"&&typeof e.json<"u"&&(e=e.json()),typeof t.callback<"u"&&t.callback){let n=this.messageExecute(null,t.callback,e,!0,i),o=n.name;if(t.callback=n,t.callback_name=o,"scripting"==l)if(null==a)n(e,t);else{let i={target:{tabId:a.tab.id},function:n,args:[e,t]};s.Browser().scripting.executeScript(i).then()}else{let n=s.notUndefined(a.tab,"id")??null;null!=n&&null==g.runtime_id?(r=this.messageExecute(null,r,{result:e,data:t},!0,i),r&&r(e,t)):s.sendMessage(r,{data:{result:e,data:t}},null,"tabs","tabs",n)}}return e}))})}if(typeof t.callback<"u"&&null!=t.callback&&null!=o&&"function"==typeof t.callback){let n=this.messageExecute(null,t.callback,e,!0,i),o=n.name;if(t.callback=n,t.callback_name=o,"scripting"==l)if(null==a)n(e,t);else{let i={target:{tabId:a.tab.id},function:n,args:[e,t]};s.Browser().scripting.executeScript(i).then()}else{let n=s.notUndefined(a.tab,"id")??null;null!=n&&null==g.runtime_id?(o=this.messageExecute(null,o,{result:e,data:t},!0,i),o&&o(e,t)):s.sendMessage(o,{data:{result:e,data:t}},null,"tabs","tabs",n)}}return n({received:!0,return_data:e})};customAddListener=(e,t=[],a=[])=>{t.forEach((t=>{e[t].addListener(((e,t,n)=>{let s=!1;typeof e.status<"u"&&(t=e,e=(n=e).id),typeof t<"u"?typeof t.status<"u"&&typeof n.url<"u"&&"complete"===t.status&&-1===n.url.indexOf("chrome://")&&(s=!0):(typeof e.name<"u"||typeof e.title<"u"||Object.keys(e).length>0)&&(s=!0),s&&a.forEach((a=>{let s=!1;"function"==typeof a?a(e,t,n):(typeof window<"u"&&!1===s&&"function"==typeof window[a]&&"function"==typeof window[a].apply&&(window[a].apply(e,t,n),s=!0),typeof ServiceWorkerGlobalScope<"u"&&!1===s&&"function"==typeof ServiceWorkerGlobalScope[a]&&ServiceWorkerGlobalScope[a](e,t,n),typeof this<"u"&&!1===s&&"function"==typeof this[a]&&this[a].call(e,t,n))}))}))}))};apiCall=async(e,t={},a="GET",n=6e4,i="json",o=1)=>{null==t&&(t={}),g.debugMode&&console.log(e,t,"Call");let l={headers:{accept:"application/json",hopekey:u.Local.uuid_hopekey??null},method:a};null!=g.runtime_id&&"/extensions/app/get_key"==e&&null==l.headers.hopekey&&delete l.headers.hopekey,null==g.runtime_id&&typeof window<"u"&&"function"==typeof window.getCookie&&(l.headers.hopekey=window.getCookie("hopekey")??u.Local.uuid_hopekey??null,null==l.headers.hopekey&&delete l.headers.hopekey);let r=e;if(-1===e.indexOf("://")){if(r=`${g.api_url}${e}`,typeof u.Local<"u"){let e=u.Local;typeof e.settings<"u"&&s.notUndefined(e.settings,"language")&&(t.lang=e.settings.language)}typeof t.uuid_search>"u"&&s.notUndefined(u.Local,"uuid_search")&&(t.uuid_search=s.notUndefined(u.Local,"uuid_search")),typeof t.uuid_hopekey>"u"&&s.notUndefined(u.Local,"uuid_hopekey")&&(t.uuid_hopekey=s.notUndefined(u.Local,"uuid_hopekey")),null!=g.runtime_id?(t.v=g.version??null,t.ri=s.Browser().runtime.getManifest().id??g.runtime_id,s.notUndefined(u.Local,"check_extension_delete")&&(t.rif=!0,delete u.Local.check_extension_delete,s.Browser().storage.local.remove("check_extension_delete")),t.bt=g.build_type):t.v=g.version??null}if(Object.keys(t).length>0&&"GET"!==a&&"json"==i&&(l.body=JSON.stringify(t)),"file"===i&&Object.keys(t).length>0){let e=new FormData;Object.keys(t).forEach((a=>{e.append(a,t[a])})),l.body=e}return await s.fetchWithTimeout(r,l,n).then((e=>{try{return e.json()}catch{return e.text()}})).then((a=>{a=this.ajaxResponse(this.ajaxResponseChipper(a),0,o),g.debugMode&&console.log(e,t,a);try{return a&&"object"==typeof a&&"object"==typeof a.modal&&this.announcementModal(a.modal),a}catch{return a}})).catch((i=>g.api_call_try<g.api_call_max_try&&-1===r.indexOf("languages/lang/sync")?setTimeout((()=>(console.log("Try",g.api_call_try,r,t,a,n,i),g.api_call_try++,s.apiCall(e,t,a,n))),3e4):g.api_call_try<2*g.api_call_max_try&&-1===r.indexOf("languages/lang/sync")?setTimeout((()=>(console.log("Try",g.api_call_try,r,t,a,n,i),g.api_call_try++,s.apiCall(e,t,a,n))),12e4):void 0))};ajaxResponse=(e,t=0,a=1)=>{if(typeof e>"u")return!1;if(1==t)return;if(typeof e.debug_time<"u"&&2!=g.debugMode)if(1==g.debugMode)console.log(e.redirect_uri,e.debug_time);else{let t={[e.redirect_uri]:e.debug_time};g.debug_time=Object.assign(g.debug_time,t)}let n={};return typeof e.languages<"u"&&(n.languages=e.languages,typeof u.Local<"u"&&(u.Local.languages=e.languages),typeof e.expire<"u"&&s.Browser().storage.local.get("expires").then((t=>{n.expires=t.expires??{},"object"!=typeof n.expires&&(n.expires={}),n.expires.languages=e.expire,u.Local.expires=n.expires,s.Browser().storage.local.set({expires:n.expires}).then(g.debugMode?console.log:null)}))),typeof e.expire<"u"&&typeof e.expire.name<"u"&&typeof e.expire.time<"u"&&s.Browser().storage.local.get("expires").then((t=>{n.expires=t.expires??{},"object"!=typeof n.expires&&(n.expires={}),n.expires[e.expire.name]=e.expire.time,Number.parseInt(e.expire.time)+600>0&&(n.expires[e.expire.name]=Number.parseInt(e.expire.time)+600),u.Local.expires=n.expires,s.Browser().storage.local.set(n).then(g.debugMode?console.log:null)})),typeof e.language_variables<"u"&&typeof e.language_variables.variables<"u"&&(n.language_variables=e.language_variables.variables,typeof u.Local<"u"&&(u.Local.language_variables=e.language_variables.variables)),typeof e.data<"u"&&s.notUndefined(e.data,"eref")&&u.Local.check_extension!=g.manuel_extension_id&&(n.check_extension=s.notUndefined(e.data,"eref")??null,typeof u.Local<"u"&&(u.Local.check_extension=n.check_extension)),"object"==typeof n&&Object.keys(n).length>0&&(g.debugMode&&console.log(n,e,"STORAGE_SET"),s.Browser().storage.local.set(n).then(g.debugMode?console.log:null)),typeof e.notifications<"u"&&typeof document<"u"&&e.notifications&&Object.keys(e.notifications).forEach((t=>{t=e.notifications[t],typeof this.notify[t.type]<"u"&&this.notify[t.type](t.message)})),typeof e.data<"u"&&1==a?e.data:e};firstUpperCase=e=>`${e.substring(0,1).toUpperCase()}${e.substring(1)}`;ucFirstUpperCase=(e,t)=>{let a=e.split(t);return a.forEach(((e,t)=>{a[t]=`${e.substring(0,1).toUpperCase()}${e.substring(1)}`})),a.join(t)};JsonParse=e=>{let t=e;if(typeof e<"u"||null!=e)try{"string"==typeof e&&(t=JSON.parse(e)),"object"==typeof t&&Object.keys(t).length>0&&Object.keys(t).forEach((a=>{let n=!1,s=!1;if("string"==typeof t[a]){const t=e.trim();n=t.startsWith("{")||t.startsWith("["),s=t.endsWith("}")||t.endsWith("]")}("object"==typeof t[a]||"string"==typeof t[a]&&n&&s)&&(t[a]=this.JsonParse(t[a]))}))}catch{}return t};settingsBuild=async(e=!1)=>new Promise((async(t,a)=>await s.Browser().storage.local.get(["settings","domain","languages"]).then((async a=>{if(typeof a.domain>"u"&&null!=a.domain&&s.domainByUrls(a.domain),a.settings){let e=!1;null!==a.settings.language&&(s.notUndefined(a.settings,"language_detail.lang_code")!==a.settings.language&&(e=!0),e&&null!==a.settings.language&&(C.language_detail=a.settings.language_detail=s.notUndefined(a.languages,`${a.settings.language}`),C.language_name=a.settings.language_name=s.notUndefined(a.languages,`${a.settings.language}.title`)))}return typeof a.settings>"u"?await s.Browser().storage.local.set({settings:C}).then((async()=>{console.log(!0,C.language);let e=await s.getLanguages(!0,C.language);return console.log(e),s.getActiveHistories(),await s.getModelSettings(),await s.getAiTypeModels(),await s.getVoices(),s.removeLoading(),t(C)})):(Object.keys(C).forEach((e=>{if(typeof C[e]<"u"){let t=C[e];a.settings&&typeof a.settings[e]>"u"&&(a.settings[e]=t)}})),a.settings&&s.Browser().storage.local.set({settings:a.settings}).then((async()=>{1==e&&(await s.getLanguages(!1,a.settings.language).then(),await s.getModelSettings(),await s.getAiTypeModels(),await s.getVoices(),await s.uuid(1==e?1:0))})),s.removeLoading(),t(a))}))));uuid=async(e=0,t={})=>{if(s.removeFirstLoading(),"object"==typeof e){let a=e;typeof a.extra_data<"u"&&typeof a.force<"u"&&(t=a.extra_data,e=a.force)}return new Promise((async(a,n)=>await s.Browser().storage.local.get().then((async i=>{u.Local=i,typeof i.developer<"u"&&null!=i.developer&&(s.notUndefined(i.developer,"beta_api")&&(g.api_url=`https://beta_api.${g.domain}`),s.notUndefined(i.developer,"debug_log")&&(g.debugMode=1)),s.Browser().storage.sync&&s.Browser().storage.sync.get().then((async e=>{u.Sync=e})),s.notUndefined(i,"settings")||(i.settings=C),null==i.settings&&(i.settings=C,i.settings.language=C.language,s.Browser().storage.local.set({settings:i.settings}).then()),g.debugMode&&console.log(C,365),null==typeof i.settings&&(i.settings=C),g.debugMode&&console.log(i.settings,367),typeof i.settings<"u"&&null!=i.settings&&typeof i.settings.ai_mode>"u"&&(i.settings=C);let o={ai_mode:i.settings.ai_mode,lang:i.settings.language,model:i.settings.ai_model,settings:i.settings};if(e||null==g.runtime_id&&typeof window<"u"&&(i.uuid_hopekey!=(window.getCookie("hopekey")??"nullS")||window.getCookie("aitopia_check_login"))&&(window.eraseCookie("aitopia_check_login"),e=1),!e&&typeof i.credit_usage<"u"&&null!=(i.uuid_hopekey??null))return void s.removeLoading();"api"==o.ai_mode&&(o.ai_key=i.settings.ai_key),s.notUndefined(o.settings,"language_detail.variables")&&(delete o.settings.language_detail.variables,s.Browser().storage.local.set({settings:o.settings}).then());let l=null;return typeof t<"u"&&null!==t&&Object.keys(t).length>0&&(l=s.notUndefined(i,"price_page_ref")||null,null!=l&&(t.price_page_ref=l),o.extra_data=t),await this.apiCall("/extensions/app/get_key",o,"POST").then((e=>{if(!e)return;let t=e;if(typeof t.key<"u"){u.Local.uuid_hopekey=t.key;let e={licences:t.licences,credit_usage:t.credit_usage,credit_detail:t.credit_detail,credit_detail_visual:t.credit_detail_visual,image_editing:t.image_editing,google_auth_uri:t.google_auth_uri??null,user:null,email:null,uuid_hopekey:t.key,uuid_search:t.search_key,plan:t.plan.toCapitalizeCase(),pricing_page_title:t.pricing_page_title,campaign_modal_api:t.campaign_modal_api??!1,campaign_modal_version:t.campaign_modal_version??null};s.notUndefined(e,"campaign_modal_version")&&null!==s.notUndefined(i,"campaign_modal_version")&&(Math.abs(new Date(s.notUndefined(i,"campaign_modal_version")).setHours(0,0,0,0)-new Date(s.notUndefined(e,"campaign_modal_version")).setHours(0,0,0,0))>=864e5||(delete e.campaign_modal_version,s.Browser().storage.local.remove(["campaign_modal_api","campaign_modal_later","campaign_modal_version","campaign_modal_limit","campaign_modal_limit_date"]))),s.notUndefined(t,"campaign_modal_version")&&(e.domain=t.domain,s.domainByUrls(t.domain)),typeof t.show_review<"u"&&(e.show_review=t.show_review),u.Local.settings&&"free"==t.plan&&typeof u.Local.settings.web_access<"u"&&(u.Local.settings.web_access=!1,e.settings=u.Local.settings),typeof t.user<"u"&&(e.user=t.user,typeof t.user.email<"u"&&(e.email=t.user.email)),typeof t.expire<"u"&&(s.notUndefined(u.Local,"expires")||(u.Local.expires={}),u.Local.expires.credits=t.expire,e.expires=u.Local.expires,g.debugMode&&console.log(u.Local.expires),g.debugMode&&console.log(e)),typeof window<"u"&&null!=e.uuid_hopekey&&g.domain_allows.forEach((t=>{window.setCookie("hopekey",e.uuid_hopekey,360,"."+t),s.Browser().runtime.id!==g.manuel_extension_id&&s.Browser().runtime.id&&window.setCookie("eref",s.Browser().runtime.id,360,"."+t),window.setCookie("ait_app",!0,360,"."+t),window.eraseCookie("aitopia_check_login","."+t)})),s.Browser().storage.local.set(e).then((()=>s.removeLoading())),u.Local=Object.assign(u.Local,e)}return a(t)})).catch((e=>(console.log(e),n())))}))))};pricingDetail=(e=!1)=>s.Browser().storage.local.get().then((t=>{if(u.Local=t,typeof t.packages<"u"&&(null==t.packages||""==t.packages)&&delete t.packages,typeof t.packages>"u"||1==e)return this.apiCall("/extensions/app/get_pricing",null,"POST").then((e=>{let t=e;if(t&&typeof t.packages<"u"){let e=t;typeof e.expire<"u"&&delete e.expire,u.Local=Object.assign(u.Local,e),typeof u.Local.expires>"u"&&(u.Local.expires={}),u.Local.expires.packages=t.expire,s.Browser().storage.local.set(e).then()}}))}));ajaxResponseChipper=e=>{if("string"!=typeof e)return e;try{return JSON.parse(I.AES.decrypt(e,"",{format:this.CryptoJSAesJson}).toString(I.enc.Utf8))}catch(t){throw console.log(t),"error"}};CryptoJSAesJson={stringify:function(e){var t={ct:e.ciphertext.toString(I.enc.Base64)};return e.iv&&(t.iv=e.iv.toString()),e.salt&&(t.s=e.salt.toString()),e.key&&(t.k=e.key.toString()),JSON.stringify(t)},parse:function(e){try{let n=I;var t=JSON.parse(e);if("string"==typeof t&&(t=JSON.parse(t)),null==t)return e;var a=n.lib.CipherParams.create({ciphertext:n.enc.Base64.parse(t.ct)});return t.iv&&(a.iv=n.enc.Hex.parse(t.iv)),t.s&&(a.salt=n.enc.Hex.parse(t.s)),t.k&&(a.key=n.enc.Hex.parse(t.k)),a}catch(n){throw console.log(n),"error"}}};_i;AesEnCrypt(e,t=null){let a=I;var n;return this._i=a.PBKDF2(this.MD5(t??g.hello_world_test),this.SHA1(t??g.hello_world_test),{keySize:8,iterations:100}),a.AES.encrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString()}AesDeCrypt(e,t=null){let a=I;var n;return null==this._i&&(this._i=a.PBKDF2(this.MD5(t??g.hello_world_test),this.SHA1(t??g.hello_world_test),{keySize:8,iterations:100})),a.AES.decrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString(a.enc.Utf8)}copyClipboard=e=>{let t=document.querySelector("#ait_clipboard"),a=!1;null===t&&(t=document.createElement("textarea"),t.id="ait_clipboard",a=!0,document.body.appendChild(t),t=document.querySelector("#ait_clipboard")),t.value=e,t.focus(),t.select(),document.execCommand("copy",!1,e),t.value="",1==a&&document.querySelector("#ait_clipboard").remove(),this.notify&&this.notify.success(this.__("Copied."))};openPage=e=>{null!=g.runtime_id?s.Browser().tabs.create({url:e.url}).then():0===e.url.indexOf(`.${g.main_dir}`)||0===e.url.indexOf(`${g.main_dir}`)?window.location=e.url.replace(`.${g.main_dir}`,"").replace(`${g.main_dir}`,"").replace(".html",""):window.location=e.url};messageCallback(e,t){e(t)}notUndefinedBuilder=(e,t)=>"object"==typeof e&&null!==e&&typeof e[t]<"u"?e[t]:!1!==t.indexOf(".")?(t.split(".").forEach((t=>{t=t.replace("###","."),typeof e<"u"&&e&&(e=typeof e[t]<"u"?e[t]:null)})),e):!!(typeof e<"u"&&e&&typeof e[t]<"u")&&e[t];notUndefined=(e,t)=>{if(null==t)return!1;if("string"==typeof t)return this.notUndefinedBuilder(e,t);if("object"==typeof t){let a=!0;return null!=t?t.forEach((t=>{this.notUndefinedBuilder(e,t)||(a=!1)})):a=!1,a}return null};SHA1=e=>(e+="_crypt",I.SHA1(e).toString());MD5=e=>(e+="_md5",I.MD5(e).toString());isPinned=e=>{if(null!=e&&document.querySelector(".setup_page #check_toolbar")){let a=document.querySelector(".setup_page #check_toolbar");if(1==e.isOnToolbar){a.value=e.isOnToolbar;var t=new Event("change");a.dispatchEvent(t)}}};minifierExpand=(e,t)=>{let a={};return e&&t?(Object.keys(e).forEach((n=>{let s=e[n];s&&Object.keys(s).forEach((e=>{let i=s[e];typeof a[n]>"u"&&(a[n]={}),a[n][t[e]]=this.JsonParse(i)}))})),a):e};filenameByType(e){if("string"!=typeof e)return!1;const t=e.match(/\.([a-zA-Z0-9]+)(?:\?|#|$)/);if(!t)return!1;const a={excel:["xlsx","xls"],word:["doc","docx"],powerpoint:["pptx","ppt"],pdf:["pdf"],image:["jpg","jpeg","webp","png","tiff","svg","gif","avif","apng"],video:["webm","mkv","flv","flv","vob","ogv","ogg","drc","gif","gifv","mng","avi","MTS","M2TS","TS","mov","qt","wmv","yuv","rm","rmvb","viv","asf","amv","mp4","m4p","m4v","mpg","mp2","mpeg","mpe","mpv","mpg","mpeg","m2v","m4v","svi","3gp","3g2","mxf","roq","nsv","flv","f4v","f4p","f4a","f4b"],zipper:["zip","rar","7z"],audio:["mp3","wav","ogg","flac","aac","wma","m4a","ape","alac","aiff","mid","amr","pcm","au","ra","aac","ac3","dts","mka","opus","midi","3ga","webm","caf","m4r","tta","wv"],code:["php","html","css","js","py","java","c","cpp","h","hpp","xml","json","sql","rb","swift","kt","pl","go","ts","dart","sh","bat","ps1"]},n=t[1].toLowerCase();for(const[s,i]of Object.entries(a))if(i.includes(n))return s;return!1}filenameByFaIcon(e,t=null){let a=null;const n={excel:"#1d6f42",word:"#41A5EE",powerpoint:"#D04423",pdf:"#f40f02"};let i=s.filenameByType(e);return i?(a=i,null==t&&(t=n[i]??t),{name:a,color:t}):(null==a&&(a="lines"),""==t&&(t=null),{name:a,color:t})}async getAiTypeModels(e=!1){return await new Promise((async(t,a)=>await s.Browser().storage.local.get("ai_type_models").then((async a=>{if(typeof a.ai_type_models<"u"&&0==e&&null!=a.ai_type_models&&Object.keys(a.ai_type_models).length>0)return await t(a.ai_type_models);let n="/ai/ai_models";g.version&&(n+="/"+s.toSeoUrl(g.version)),await s.apiCall(n,{},"POST").then((async e=>{if(!e)return setTimeout(s.getAiTypeModels,1e3);e=s.minifierExpand(e,e.schema),await s.Browser().storage.local.set({ai_type_models:e});let t={};return e&&(Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{t[e.model_id]=e}))})),await s.Browser().storage.local.set({ai_models:t})),e})),t(a)}))))}async getModelSettings(e=!1){return await new Promise((async(t,a)=>await s.Browser().storage.local.get("model_settings").then((async a=>{if(typeof a.model_settings<"u"&&0==e&&null!=a.model_settings&&Object.keys(a.model_settings).length>0)return await t(a.model_settings);await s.apiCall("/ai/model_settings",{},"POST").then((async e=>e?(await s.Browser().storage.local.set({model_settings:e}),e):setTimeout((()=>s.getModelSettings(!0)),1e3))),t(a)}))))}async getVoices(e=!1){return await new Promise((async(t,a)=>await s.Browser().storage.local.get("voices").then((async a=>{if(typeof a.voices<"u"&&0==e&&null!=a.voices&&Object.keys(a.voices).length>0)return await t(a.voices);await s.apiCall("/ai/voices",{},"POST").then((async e=>e?(await s.Browser().storage.local.set({voices:e}),e):setTimeout((()=>s.getVoices(!0)),1e3))),t(a)}))))}slugify=e=>e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");vueDefaultChecker(e,t,a,n,i=null,o=!0){if(a=s.notUndefined(a,s.notUndefined(n,"model_prefix")),0!=o)return a===i;if(null!=i&&null!=a)return a!=i?null:i;let l=s.notUndefined(e,t);if(null!=l)return l;let r=l??s.notUndefined(e,s.notUndefined(n,"model_default"))??i??s.notUndefined(n,"default"),c=!0;return typeof a<"u"&&(c=a==r),0==o?typeof r>"u"?null:r:(1==c&&null!=r&&s.notUndefined(u.Local,t),c)}autoHeightTextArea(e,t=null){e.style.height="unset",null==t&&(t=e.style.maxHeight.match(/[-+]?([0-9]*\.[0-9]+|[0-9]+)/)[0]??200),t<=e.scrollHeight&&(e.style.height=e.scrollHeight+"px")}getReadableFileSizeString(e){var t=-1,a=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(2)+a[t]}__(e,t="tr"){if(null==e)return e;let a=I.SHA1(e).toString(),n=g.lang_cache_type;return null!=C&&"object"==typeof u.Local.languages&&typeof C.language<"u"&&null!==u.Local.languages&&null!==C.language&&typeof u.Local.languages[C.language]<"u"&&(null==C.language_name||""==C.language_name)&&typeof u.Local.languages[C.language].name<"u"&&typeof u.Local.settings<"u"&&(s.notUndefined(u.Local,"settings.language")&&(C.language=s.notUndefined(u.Local,"settings.language")),u.Local.settings.language_name=C.language_name=u.Local.languages[C.language].name,u.Local.settings.language_detail=C.language_detail=u.Local.languages[C.language],s.Browser().storage.local.set({settings:u.Local.settings}).then()),typeof u<"u"&&null!==C.language_name&&typeof u[n]<"u"&&s.notUndefined(u[n],"language_variables")&&typeof u[n].language_variables[a]<"u"?u[n].language_variables[a]:e=this.setLangVar(a,e)}async getLanguages(e=!1,t=null,a=null){let n=g.lang_cache_type;t=t??u[n].settings.language??C.language;let i=!1;if(typeof u[n].languages<"u"&&(0==Object.keys(u[n].languages??{}).length||null==u[n].languages||"{}"==u[n].languages)&&(delete u[n].languages,delete u[n].language_variables,delete u[n].language_var_sync),typeof u[n].languages>"u"||e)return null!=a&&(u[n].settings.language=a.settings.language=t),typeof u[n].languages>"u"&&(u[n].languages={},i=!0),await s.apiCall("/languages/lang/get/lang/"+t,{language:t},"POST").then((e=>{try{return typeof e>"u"||typeof e.languages>"u"?void 0:(e=s.JsonParse(e),i&&s.Browser().storage[n.toLowerCase()].set({languages:JSON.stringify(e.languages)}).then(),typeof e.expire<"u"&&(s.notUndefined(u.Local,"expires")||(u.Local.expires={}),u.Local.expires.languages=s.JsonParse(e.expire),s.Browser().storage[n.toLowerCase()].set({expires:u.Local.expires}).then()),u[n].language_variables=s.JsonParse(e.language_variables.variables),u[n].languages=s.JsonParse(e.languages),s.Browser().storage[n.toLowerCase()].set({language_variables:JSON.stringify(e.language_variables.variables),languages:u[n].languages}).then((e=>s.Browser().storage[n.toLowerCase()].get("settings").then((e=>(u[n].settings=e.settings??C,u[n].settings.language_name=C.language_name=u[n].languages[t].name,u[n].settings.language_detail=C.language_detail=u[n].languages[t],u[n].settings.language=C.language=t,s.Browser().storage.local.set({settings:u[n].settings}).catch((e=>console.log(e))).finally((()=>{typeof a<"u"&&null!=a&&"function"==typeof a.changeSettings&&(a.changeSettings(),1==Object.keys(a.ai_chat).length&&"function"==typeof a.newChat&&a.newChat()),s.Browser().tabs&&s.Browser().tabs.query({url:g.site+"/*"}).then((e=>{e.forEach((e=>{null!=t&&null!=s.Browser().scripting&&"complete"==e.status&&s.Browser().scripting.executeScript({target:{tabId:e.id},func:this.changeSiteLanguage,args:[t]}).catch((t=>{console.warn(t,e)})).then()}))}))}))))))))}catch(o){console.log(o)}})).catch(console.error)}changeSiteLanguage=(e=null)=>{if(null==e){let t=u.Local;typeof t.settings<"u"&&typeof t.settings.language<"u"&&null!=t.settings.language&&(e=t.settings.language)}null!=e&&(window.lang=e,localStorage.getItem("lang")!=window.lang&&(localStorage.setItem("lang",e),localStorage.removeItem("languages"),localStorage.removeItem("language_variables")))};setLangVar(e,t){let a=g.lang_cache_type,n=!1;if(!(null==t||typeof u>"u"||typeof u[a]>"u"))return typeof u[a].language_variables>"u"&&(u[a].language_variables={}),s.notUndefined(u[a],"language_variables")||(u[a].language_variables={}),s.notUndefined(u[a].language_variables,e)||(n=!0),"string"==typeof u[a].language_variables&&null!=u[a].language_variables&&(u[a].language_variables=JSON.parse(u[a].language_variables)),"object"!=typeof u[a].language_variables&&(u[a].language_variables=[]),u[a].language_variables&&(u[a].language_variables[e]=t),"development"!=g.mode||t&&0==n||(typeof u[a].language_var_sync>"u"&&(u[a].language_var_sync={}),("object"!=typeof u[a].language_var_sync||null==u[a].language_var_sync)&&(u[a].language_var_sync={}),u[a].language_var_sync[e]=t,s.Browser().storage[a.toLowerCase()].set({language_var_sync:JSON.stringify(u[a].language_var_sync)}).then()),t}async captureCurrentViewport(){return new Promise(((e,t)=>{console.log(s.Browser().tabs,s.Browser().tabs.captureVisibleTab),s.Browser().tabs.captureVisibleTab(void 0,{format:"jpeg",quality:80}).then((a=>a?e(a):t(null)))}))}setAIImageURL(e){let t=g.lang_cache_type;typeof u[t]>"u"||(s.Browser().storage[t.toLowerCase()].set({ai_image_url:e}).then(),typeof u[t].ai_image_url>"u"&&(u[t].ai_image_url={}),u[t].ai_image_url=e)}syncLangVar(){setTimeout((()=>{if("development"!=g.mode)return;let e=g.lang_cache_type;if(s.Browser().storage[e.toLowerCase()].set({language_var_sync:JSON.stringify(u[e].language_var_sync)}).then(),s.Browser().storage[e.toLowerCase()].set({language_variables:JSON.stringify(u[e].language_variables)}).then(),typeof u[e].language_var_sync<"u"){if(!s.notUndefined(u[e],"language_var_sync"))return;let t=u[e].language_var_sync;if(Object.keys(t).length>0){let a={data:t,language:"en"};s.apiCall("/languages/lang/sync",a,"POST",-1).then((t=>{s.Browser().storage[e.toLowerCase()].remove(["language_var_sync"]).then()}))}}}),2e3)}auth(e,t,a="register",n){let s=n.target,i=!1;s.setAttribute("disabled","disabled");let o=s.closest(`#${a}`);document.querySelectorAll(".input-error").forEach((e=>{e.classList.remove("input-error")}));let l=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;return null==t.email&&(t.email=""),(t.email.length<3||!t.email.match(l))&&(null!=o&&o.querySelector('[name="email"]').classList.add("input-error"),this.notify.error(this.__("Please check your e-mail address.")),i=!0,s.removeAttribute("disabled")),"register"==a?(null==t.password&&(t.password=""),null==t.password1&&(t.password1=""),null==t.agree&&(t.agree=!1),t.password.length<3&&(null!=o&&o.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),s.removeAttribute("disabled"),i=!0),t.password1.length<3&&(null!=o&&o.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Please check your confirm password.")),s.removeAttribute("disabled"),i=!0),t.password1!=t.password&&(e.forms.password1=null,null!=o&&o.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Your passwords do not match. Please check and try again.")),s.removeAttribute("disabled"),i=!0),0==t.agree&&(null!=o&&o.querySelector('[name="agree"]').classList.add("input-error"),this.notify.error(this.__("I have read and agree to terms.")),s.removeAttribute("disabled"),i=!0),1==i?void 0:this.apiCall("/auth/register",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return this.uuid(1).then((()=>{e.login=!0,s.removeAttribute("disabled")}));s.removeAttribute("disabled")}))):"login"==a?(null==t.password&&(t.password=""),t.password.length<3&&(null!=o&&o.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),s.removeAttribute("disabled"),i=!0),1==i?void 0:this.apiCall("/auth/login",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?this.uuid(1).then((()=>{e.login=!0,s.removeAttribute("disabled")})):t;s.removeAttribute("disabled")}))):"recover"==a?1==i?void 0:this.apiCall("/auth/reset_password",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?(e.login_type="login",s.removeAttribute("disabled"),!0):t;s.removeAttribute("disabled")})):void 0}scrollToBottom(e=null,t="#ai-message-container,#ait-prompt-container",a=null){if(!document)return;let n=e;document.querySelectorAll(t).forEach((t=>{let s=t;typeof s.scrollTop>"u"||(s.scrollTop,s.scrollHeight,s.clientHeight,null!==s.getAttribute("data-scroll-lock")&&null!==e?s.addEventListener("scroll",(()=>{const t=s.scrollTop,a=undefined,i=undefined,o=s.scrollHeight-t-s.clientHeight;let l=null;null!==s.querySelector("#aitopia-message [aria-details]")&&(l=s.querySelectorAll("#aitopia-message [aria-details]")[s.querySelectorAll("#aitopia-message [aria-details]").length-1]);let r=0;null!==l&&(l=l.querySelector(".ait-event-item:last-child"),null!==l&&(r=l.offsetHeight,r>0&&(e=n+r))),s.setAttribute("data-scroll-lock",o>e)})):s.setAttribute("data-scroll-lock",!1),"false"==(s.getAttribute("data-scroll-lock")??!1).toString()&&setTimeout((()=>{if(typeof s.scrollTop<"u"){const t=a??s.scrollHeight+5e4;s.scrollTo({top:t,behavior:"smooth"}),null==e&&setTimeout((()=>{s.scrollTo({top:t,behavior:"smooth"}),s.setAttribute("data-scroll-lock",!1)}),900),s.setAttribute("data-scroll-lock",!1)}}),30))}))}newChatId(){return Date.now()}ChatId(e,t,a=0){let n=null,i=u.Local.ai_chat_ids??{};return typeof i<"u"&&0==a&&typeof i[e]<"u"&&(null!=t&&"__all"!=t?(i[e][t]||"number"==typeof i[e])&&(n=i[e][t]):n=i[e]),null==n&&(a=1),e&&1==a&&(t?((typeof i[e]>"u"||"object"!=typeof i[e])&&(i[e]={}),n=i[e][t]=this.newChatId()):n=i[e]=this.newChatId()),s.Browser().storage.local.set({ai_chat_ids:i}).then(),n}GoogleSearchCall=async e=>{if(null==g.runtime_id)return!1;let t=s.notUndefined(u.Local,"settings.language")??null;if(null==t)try{return fetch("https://www.google.com/search?q="+e+"&sourceid=chrome&ie=UTF-8").then((e=>e.text())).catch(console.log)}catch{return!1}try{return fetch(`https://www.google.com/search?hl=${t}&lr=lang_${t}&as_q=${e.replace(/ /gi,"+")}&sourceid=chrome&ie=UTF-8`).then((e=>e.text())).catch(console.log)}catch{return!1}};GoogleSearchCallback=async(e,t={},a=!0)=>{let n=null;"object"==typeof e&&typeof e.result<"u"&&(t=e.data??{},e=e.result??{},n=s.notUndefined(t,"data"));let i=(new DOMParser).parseFromString(e,"text/html"),o="",l={},r=0,c="",d="",p={},_=i.querySelector("#search block-component table");null!=_&&(_=_.outerHTML);let m="";if(null!=_){let e=i.querySelectorAll("#search block-component table");null!=i.querySelector("#search block-component table table")&&(e=i.querySelectorAll("#search block-component table table")),e.forEach((e=>{e.querySelectorAll("tr").forEach(((e,t)=>{let a=e;null!=a.querySelector("th")?(a.querySelectorAll("th").forEach((e=>{let t=e;null!=t.querySelector('span[aria-hide],[class*="hide"]')?null!=t.querySelector("* span:last-child")&&(m+="  "+t.querySelector("* span:last-child").innerText.trim()):m+="  "+t.innerText.trim()})),m=m.trim()+"\n"):(a.querySelectorAll("td").forEach((e=>{let t=e;null!=t.querySelector("span[aria-hide]")?null!=t.querySelector("* span:last-child")&&(m+="  "+t.querySelector("* span:last-child").innerText.trim()):m+="  "+t.innerText.trim()})),m=m.trim()+"\n")}))}))}null!=i.querySelectorAll("#search [data-snc]")&&i.querySelectorAll("#search [data-snc]").forEach(((e,t)=>{Object.keys(l).length<=(g.web_access_search_limit??5)&&(e.querySelectorAll("[data-sncf],[data-snhf]").forEach(((e,t)=>{let a=!1,n=e,s=n.querySelector("a h3"),i=null;if(null!=s&&(a=!0,c=s.closest("a").getAttribute("href"),d=s.innerText),a||(i=n.querySelectorAll("a"),null!=i&&i.forEach((e=>{p[e.innerText]=e.getAttribute("href")}))),-1===n.innerHTML.indexOf('role="img"')&&!a){let e=n.innerText.split(" — ");o+=e[1]??e[0]}n.getAttribute("data-sncf")})),l[r]={text:o,url:c,title:d,sub_links:p},d=c=o="",p={},r++)}));let h=null;null!=i.querySelector("#search [data-entityname] [data-domdiff]")&&(h=i.querySelector("#search [data-entityname] [data-domdiff]").innerText.replace(/\n/gi," ")??null);let f=[];null!=i.querySelector("#search [data-q]")&&i.querySelectorAll("#search [data-q]").forEach((e=>{f.push(e.innerText)}));let y="";null!=i.getElementById("rhs")&&(null!=i.querySelector("g-card-section")&&i.querySelectorAll("g-card-section").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(y+="\n"+t)}})),null!=i.querySelector("#rhs g-link")&&i.querySelectorAll("#rhs g-link").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(y+="\n"+t)}})),i.querySelectorAll("#rhs [data-maindata]+div span,#rhs [data-maindata]+div .title").forEach((e=>{let t=e;null==t.closest('[role="button"]')&&t.innerText&&(y+="\n"+t.innerText)})),""==y&&(y=y.trim()));let w={};try{w={original_ask:n,data:l,extra:h,questions:f,detail:y,table:m}}catch{}let b=!1;if(Object.keys(s.notUndefined(w,"data")).length>0&&(b=!0),!b&&(s.notUndefined(e,"data.data")||s.notUndefined(t,"data"))){let a=await this.apiCall("/ai/search",{q:s.notUndefined(e,"data.data")||s.notUndefined(t,"data"),lang_code:s.notUndefined(u.Local,"settings.language")??null,model:C.ai_model},"POST");s.notUndefined(a,"data")&&(w={original_ask:s.notUndefined(a,"original_ask"),data:s.notUndefined(a,"data"),extra:null,questions:s.notUndefined(a,"questions"),detail:null,table:null})}if(a){let e=await s.Browser().storage.local.get("settings"),t=C.ai_model;s.notUndefined(e,"settings")&&(t=s.notUndefined(e,"settings.ai_model"));let a=typeof s.Browser().web_access_mode<"u"?s.Browser().web_access_mode:"ai_chat",i=typeof s.Browser().web_access_extra_key<"u"?s.Browser().web_access_extra_key:"__all";X.chat(n,t,a,i,!0,!1,null,!0,{search:w,web_access:!0})}return new Promise(((e,t)=>e(w)))};cleanTextEmpty(e){return e&&e.replace(/[\r\n]+/gm," ").replace(/[\t]+/gm," ").replace(/[\s]+/gm," ").trim()}prepareContentForSearch(e){if(!e)return"";if("string"==typeof e)try{e=JSON.parse(e)}catch{return e.substring(0,2e3)}let t=[];if(e.meta&&(e.meta.title&&t.push(e.meta.title),e.meta.description&&t.push(e.meta.description)),e.importantTags&&["h1","h2","h3"].forEach((a=>{e.importantTags[a]&&t.push(e.importantTags[a].replace(/ OR /g," "))})),e.mainContent){const a=e.mainContent.split(/[.!?]+/).map((e=>e.trim())).filter((e=>e.length>20));a.length>0&&t.push(a.slice(0,3).join(" "))}return t.join(" ").replace(/\s+/g," ").replace(/[^\w\s-]/g,"").trim().substring(0,2e3)}parseMeaningfulContentFromHTML(e){var t,a,n,s,i,o,l;const r=(new DOMParser).parseFromString(e,"text/html");["script","style","iframe","nav","header","footer","aside","noscript","link","body .ad","body .advertisement","body #ads","body #ad-container","body .social-share","body .comments","body .related-articles",'body [class*="ads"]','body [id*="ads"]','body [class*="banner"]'].forEach((e=>{r.querySelectorAll(e).forEach((e=>e.remove()))}));const c={importantTags:{},meta:{title:"",description:""},mainContent:null};c.meta.title=(null==(a=null==(t=r.querySelector("title"))?void 0:t.textContent)?void 0:a.trim())||"",c.meta.description=(null==(s=null==(n=r.querySelector('meta[name="description"]'))?void 0:n.getAttribute("content"))?void 0:s.trim())||"",["h1","h2","h3","h4","h5","h6"].forEach((e=>{const t=r.querySelectorAll(e);t.length>0&&(c.importantTags[e]=Array.from(t).map((e=>{var t;return null==(t=null==e?void 0:e.textContent)?void 0:t.trim()})).filter((e=>e)).join(" OR "))}));const u=["article","main",".content",".post-content",".article-content","#main-content",'[role="main"]'];for(const d of u){const e=r.querySelector(d);if(e){c.mainContent=(null==(i=null==e?void 0:e.textContent)?void 0:i.trim().replace(/\s+/g," ").replace(/\n\s*/g,"\n").replace(/\s*\n\s*\n\s*/g,"\n\n"))||null;break}}return c.mainContent||(c.mainContent=(null==(l=null==(o=null==r?void 0:r.body)?void 0:o.textContent)?void 0:l.trim().replace(/\s+/g," ").replace(/\n\s*/g,"\n").replace(/\s*\n\s*\n\s*/g,"\n\n"))||null),c}setSidebar(e="#aitopia-full-screen",t="aitopia-full"){if(!document)return;let a=document.createElement("div");a.id="aitopia-container";let n=document.createElement("div");n.id="aitopia",null!=document.querySelector(e)?(n.id=t,document.querySelector(e).classList.add("aitopia")):n.classList.add("aitopia"),n.append(a);let s=document.querySelector("body");-1==(s.getAttribute("id")??"").indexOf("aitopia")&&(s=document.querySelector("html")),null==s||s.append(n)}tabExtensionPage=(e=null)=>{if(s.notUndefined(e,"filters")){let t=!0;return s.Browser().tabs.query(s.notUndefined(e,"filters")).then((a=>{a.forEach((a=>{if(t=!1,s.notUndefined(e,"filter_url")?-1!==a.url.indexOf(s.notUndefined(e,"filter_url"))&&(t=!0):t=!0,console.log(t,s.notUndefined(e,"filter_url")),s.notUndefined(e,"url")&&t&&(e.active=!0,s.Browser().tabs.update(a.id,{url:e.url}).then()),t)return a}))}))}};removeEmptyLines(e){return e&&e.replace(/^\s*[\r\n]/gm,"").trim()}treeKeybyValueBuild(e,t,a,n=".",s=0,i={}){if("object"!=typeof e&&(e=e.split(n)),typeof e[s]>"u")return t;typeof a[e[s]]<"u"&&(i[e[s]]=a[e[s]]);try{i[e[s]]=this.treeKeybyValueBuild(e,t,a,n,s+1,i[e[s]]??{})}catch(o){console.error(o,"BBB")}return i}Browser(){return g.Browser}addLoading(){if(null==g.runtime_id&&typeof document<"u"){let e="body > .aitopia";return null==g.runtime_id&&(e="body.aitopia"),void(document&&null!=document.querySelector(e)&&null==document.querySelector(e+".ait-page-loading")&&document.querySelector(e).classList.add("ait-page-loading"))}}removeLoading(){let e=".ait-page-loading-container";if(null!=g.runtime_id&&(e="#aitopia-full-screen .ait-page-loading-container"),typeof document<"u"&&document&&null!=document.querySelector(e)&&(document.querySelectorAll(e).forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(e).forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(e).forEach((e=>e.remove())),s.scrollToBottom()}),5)),typeof document<"u"&&document){let e="body > .aitopia";null==g.runtime_id&&(e="body.aitopia"),setTimeout((()=>{null!=document.querySelector(e+".ait-page-loading")&&document.querySelector(e+".ait-page-loading").classList.remove("ait-page-loading"),s.scrollToBottom()}),1)}}removeFirstLoading(){null==g.runtime_id&&typeof document<"u"&&null!=document.querySelector(".ait-page-loading-container")&&(document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove()))}),5))}async getIpDetail(){return{}}syncTimeout=null;_syncAppAndExtensionOrTabs=async(e=null)=>{"object"==typeof e&&null!==e&&0===Object.keys(e).length&&(e=null);let t=null;null==g.runtime_id&&(t=g.domain);let a=!0,n=!1;null!=e&&(typeof e.back<"u"&&(a=!1),typeof e.type<"u"&&(n=e.type),typeof e.setter_domain<"u"&&(t=e.setter_domain),typeof e.storage<"u"&&(e=e.storage));let i={storage:e,type:n,setter_domain:t};if(null!=g.runtime_id)return null!=e&&await s.GetSetSyncData(i),await s.TabMessageSync({target:null,function:async e=>(e.back=!1,await window.postMessage({fn:"SyncAppAndExtensionOrTabs",data:e})),args:[i]},t);if(null==e){if(!s.notUndefined(g.ExtensionBrowser,"runtime.sendMessage"))return!1;i.storage=await s.GetSetSyncData();let e=await g.ExtensionBrowser.runtime.sendMessage(g.manuel_extension_id,{fn:"GetSetSyncData",data:i});if(i.storage=s.notUndefined(e,"return_data"),i.type=!0,"object"==typeof i.storage&&null!=i.storage&&0==Object.keys(i.storage).length&&(i.storage=null),null==i.storage)return{}}else if(i.type=!1,a){if(!s.notUndefined(g.ExtensionBrowser,"runtime.sendMessage"))return!1;await g.ExtensionBrowser.runtime.sendMessage(g.manuel_extension_id,{fn:"SyncAppAndExtensionOrTabs",data:i})}return await s.GetSetSyncData(i)};SyncAppAndExtensionOrTabs=async(e=null)=>(this.syncTimeout&&clearTimeout(this.syncTimeout),new Promise((t=>{this.syncTimeout=setTimeout((async()=>{let a=await this._syncAppAndExtensionOrTabs(e);t(a)}),400)})));GetSetSyncData=async(e=null)=>{if(null!=e){let t=!1;s.notUndefined(e,"setter_domain")&&s.notUndefined(e,"setter_domain"),typeof e.type<"u"&&(t=e.type);let a=s.notUndefined(u.Local,"migration"),n=s.notUndefined(e,"storage.local.migration");return null==n&&(n=s.notUndefined(e,"storage.local.ai_chat_ids.ai_chat")),0==t&&(t=a<n||null==a),1==t&&s.notUndefined(e,"storage")?(Object.keys(e.storage).forEach((t=>{if(s.notUndefined(s.Browser().storage,t)){let i=t.toCapitalizeCase();null==a&&(e.storage.local.migration=n??(new Date).getTime()),e.storage[t]&&(e.storage[t]=s.JsonParse(e.storage[t]),(typeof e.storage[t].settings>"u"||null!=s.notUndefined(e.storage[t],"settings"))&&(u.Local.migration_status=!0,e.storage[t].migration_status=!0,s.Browser().storage[t].set(e.storage[t]).then((()=>{u.Local.migration_status=!1,s.Browser().storage.local.set({migration_status:!1}),u[i]=Object.assign(u[i],e.storage[t])}))))}})),{}):{local:s.JsonParse(u.Local),sync:s.JsonParse(u.Sync),runtime_id:g.runtime_id}}return{local:s.JsonParse(u.Local),sync:s.JsonParse(u.Sync),runtime_id:g.runtime_id}};TabMessageSync=async(e,t=null)=>{if(s.notUndefined(s.Browser().tabs,"query")&&g.domain_allows&&e){let a=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im,n=Object.values(g.domain_allows);null!=t&&-1!==n.indexOf(t)&&n.splice(n.indexOf(t),1),n.forEach((t=>{s.Browser().tabs.query({status:"complete"}).then((n=>{n.forEach((async n=>{if(n.url){let i=n.url.match(a)[1]??null;null!=i&&-1!==i.indexOf(g.web_app_prefix+t)&&(-1!==n.url.indexOf("https://"+g.web_app_prefix+t+"/")||-1!==n.url.indexOf("https://beta_"+g.web_app_prefix+t+"/"))&&(u.Local.migration_status=!0,e.target={tabId:n.id},await s.Browser().scripting.executeScript(e),u.Local.migration_status=!1,await s.Browser().storage.local.set({migration_status:!1}))}}))}))}))}};setHistory=(e,t)=>s.apiCall("/extensions/app/set_history",{chat_id:e,history:t},"POST").then((async e=>{if(s.notUndefined(e,"all_histories")){let t=s.notUndefined(e,"all_histories");return t&&(t=s.getHistoryFixer(t)),s.Browser().storage.local.set({histories:t}),t}}));getHistories=(e=!1)=>new Promise((t=>s.Browser().storage.local.get("histories").then((a=>typeof a.histories<"u"&&0==e&&null!=a.histories&&Object.keys(a.histories).length>0?t(a.histories):s.apiCall("/extensions/app/get_history",null,"POST").then((async e=>{if(s.notUndefined(e,"all_histories")){let t=s.notUndefined(e,"all_histories");return t&&(t=s.getHistoryFixer(t)),s.Browser().storage.local.set({histories:t}),t}}))))));getActiveHistories=async(e={})=>{let t=await s.Browser().storage.local.get("ai_chat_ids")??{};return t.ai_chat_ids&&(t=t.ai_chat_ids),await s.apiCall("/extensions/app/get_active_history",{chat_ids:t},"POST").then((async e=>{if(s.notUndefined(e,"histories")){let a=s.notUndefined(e,"histories"),n=s.notUndefined(e,"history_ids");a&&(a=s.getHistoryFixer(a));let i=await s.Browser().storage.local.get("ai_single").ai_single??{};i=Object.assign(i,a.ai_single);let o={};return a.ai_chat&&Object.keys(a.ai_chat).length>0&&(o.ai_chat=a.ai_chat),i&&Object.keys(i).length>0&&(o.ai_single=i),n&&Object.keys(n).length>0&&(n=Object.assign(n,t),o.ai_chat_ids=n,u.Local.ai_chat_ids=n),Object.keys(o).length>0&&await s.Browser().storage.local.set(o),u.Local=Object.assign(u.Local,o),{histories:a,history_ids:n}}}))};getHistoryFixer=e=>{let t=this.__("Hello, how can I help you today?");return Object.keys(e).forEach((a=>{s.notUndefined(e,a)&&(s.notUndefined(e[a],"0.role")?"user"==s.notUndefined(e[a],"0.role")&&(e[a]=[{item:t,role:"assistant",model:s.notUndefined(e[a],"0.model"),loading:!1},...Object.values(e[a])]):Object.keys(e[a]).forEach((n=>{s.notUndefined(e[a],n)&&s.notUndefined(e[a][n],"items")&&"user"==s.notUndefined(e[a][n].items,"0.role")&&(e[a][n].items=[{item:t,role:"assistant",model:s.notUndefined(e[a][n].items,"0.model"),loading:!1},...Object.values(e[a][n].items)])})))})),e};getSearchFilter=(e,t=null,a=!1)=>t?Object.values(e).filter((e=>"object"==typeof e?Object.values(e).some((e=>"object"==typeof e&&1==a?JSON.stringify(e).toString().toLowerCase().includes(t.toLowerCase()):e.toString().toLowerCase().includes(t.toLowerCase()))):"string"==typeof e?-1!==e.toLowerCase().indexOf(t.toString().toLowerCase()):void 0)):e;getKeySearch=(e,t=null,a=!1,n=!1)=>{if(!t)return e;let s=null;return s=1==a?{}:[],Object.keys(e).some((i=>{i.toString().toLowerCase().includes(t.toLowerCase())&&(1==a?n?s[i.replace(t,"")]=e[i]:s[i]=e[i]:s.push(i)),i.toString().toLowerCase().includes(t.toLowerCase())})),s};domainByUrls=e=>{s.Browser().storage.local.set({domain:e});let t=g.web_app_prefix+e,a={domain:e,site:`https://${t}`,site_buy_plan:`https://${t}/subscription`,site_payment:`https://${t}/payment`,site_pricing:`https://${t}/pricing`,login:`https://${t}/auth`,api_url:`https://${g.api_mode}.${e}`,download_url:`https://download.${e}`,cdn_url:`https://cdn.${e}`};return g.domain_allows&&-1===g.domain_allows.indexOf(e)&&g.domain_allows.push(e),Object.keys(a).forEach((e=>{g[e]=a[e]})),a};ObjectSorting=(e,t=!0,a=null)=>Object.fromEntries(Object.entries(e).sort((([,e],[,n])=>(null!==a&&(typeof e[a]<"u"&&(Number.isNaN(parseFloat(e[a]))||(e=e[a])),typeof n[a]<"u"&&(Number.isNaN(parseFloat(n[a]))||(n=n[a]))),t?parseFloat(e)-parseFloat(n):parseFloat(n)-parseFloat(e)))));clearStorage=(e=!1)=>{1==e&&(s.Browser().storage.local&&s.Browser().storage.local.clear(),s.Browser().storage.sync&&s.Browser().storage.sync.clear());let t=["app_details","check_extension_expire","check_extension","token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","start_scrap","language_var_sync","language_variables","languages","ai_models","ai_type_models","ai_prompts","selected_ask","selected_question","selected_write","prompt_settings","model_settings","files","faq","packages","developer","domain","draggable_modal_history","ai_chat_ids","ai_contextPrompts","delete_key","ai_single","speech_record","ai_ask","campaign_modal_api","campaign_modal_later","campaign_modal_version","campaign_modal_limit","campaign_modal_limit_date","ai_workflow_stream","ai_workflow","price_page_ref"];s.Browser().storage.local.get().then((e=>{s.Browser().storage.local.remove(s.getKeySearch(e,"ai_single_"))}));let a={ai_single:[s.SHA1("image"),s.SHA1("chat_with_file")]};s.Browser().storage.local.get("delete_key").then((e=>{"object"==typeof e.delete_key&&Object.values(e.delete_key).forEach((e=>{a.ai_single.push(e)}))})),s.Browser().storage.local.get("ai_prompts").then((e=>{let t={};if(typeof e.ai_prompts<"u"){try{t=JSON.parse(e.ai_prompts)}catch{t=e.ai_prompts}let a=[];Object.values(t).forEach((e=>{let t=e.mode;"object"==typeof t&&(t=t.join(",")),-1==a.indexOf("selected_"+t)&&a.push("selected_"+t)})),s.Browser().storage.local.remove(a).then()}})),s.Browser().storage.local.remove(t).then(),Object.keys(a).forEach((e=>{s.Browser().storage.local.get(e).then((t=>{if(typeof t[e]<"u"){let n=!1,i=!1;try{t[e]=JSON.parse(t[e]),i=!0}catch{}let o=a[e];null!==t[e]&&("object"==typeof t[e]?Object.keys(t[e]).forEach((a=>{-1===o.indexOf(a)&&(n=!0,delete t[e][a])})):(n=!0,delete t[e])),i&&(t[e]=JSON.stringify(t[e])),n&&s.Browser().storage.local.set(t).then()}}))})),s.Browser().storage.local.remove(["ai_setup"]).then(),s.Browser().storage.local.set({show_sidebar:!1}).then()};promptIdByGetValues=e=>{let t=u.Local.prompt_settings,a=u.Local.model_settings,n={};return t&&(Object.keys(t).forEach((i=>{if(-1!==i.indexOf(e)){let e=i.split("-_-"),o=e[0],l=t[i],r=s.notUndefined(a,`${o}`),c=s.notUndefined(r,`items.${l}`),u=s.notUndefined(c,"title");n[i]={name:r.title,id:e[0]??null,value:l,priority:e[1].split("_")[1]??0,title:u??o}}})),n=s.ObjectSorting(n,!0,"priority")),n};emptyResolve=()=>new Promise(((e,t)=>{}));onSettingTypeByValue(e,t){if(e&&typeof e.type<"u"){if(typeof e.mode<"u"&&"attribute"==e.mode)return t.getAttribute(e.type);if(typeof t[e.type]<"u")return t[e.type]}}emailSuggestion=async(e,t,a)=>{let n=this.MD5(e);return s.Browser().storage.local.get("email_suggestions").then((async i=>s.notUndefined(i,"email_suggestions."+n)?s.notUndefined(i,"email_suggestions."+n):await this.apiCall("/ai/email_suggestion",{text:e,history:t,extra_data:a},"POST").then((e=>(i[n]=e,e)))))};positionByScreenCalc(e,t=10){let a=Math.max(-1,Math.min(e.top,window.innerHeight-(e.top+e.height+t)));a=a<=0?-(e.height+t):e.height+t;let n=Math.max(-1,Math.min(e.top,window.innerWidth-(e.top+e.width+t)));return n=n<=0?-(e.width+t):e.width+t,{top:a,left:n}}async getYtSummarize(){let e="",t=null;if(typeof window<"u"&&window.location&&-1!==window.location.host.indexOf("youtube.")){t=window.ytInitialPlayerResponse??null,null===t&&document.querySelectorAll("body script").forEach((e=>{if(e){let a=e;if(-1!==a.innerText.indexOf("var ytInitialPlayerResponse"))try{t=JSON.parse(a.innerText.match("{.*:{.*:.*}}")[0])}catch{}}}));let a=u.Local.settings.language;if(typeof(null==t?void 0:t.captions)>"u")return{};if(typeof(null==t?void 0:t.captions.playerCaptionsTracklistRenderer)>"u")return{};if(typeof(null==t?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks)>"u")return{};let n=null==t?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks,i=null;if(n&&(n.forEach((e=>{a===e.languageCode&&(i=s.notUndefined(e,"baseUrl"))})),null==i&&(i=s.notUndefined(n,"0.baseUrl"))),null!==i&&t){let a=await fetch(i).then((e=>e.text())),n={compact:!1,ignoreComment:!0,spaces:4};a=s.JsonParse(he.xml2json(a,n))??a;let o=s.notUndefined(a,"elements.0.elements");return o&&o.forEach(((t,a)=>{let n={text:"",start:s.notUndefined(t,"attributes.start"),dur:s.notUndefined(t,"attributes.dur")},i=s.notUndefined(t,"elements");i&&i.forEach(((e,t)=>{n.text+=0!==t?" "+e.text:e.text})),e+="second:"+parseFloat(n.start).toFixed(0)+" text:"+n.text+"\n"})),{content:e,detail:t,url:i}}}}eventMarkedInText(){document.querySelector(".aitopia").addEventListener("mouseover",(e=>{let t=e.target.closest("pre code");if(null!=t&&null===t.querySelector(".ait-code-toolbox")&&null===t.querySelector(".ait-pre-header")){let e=t.innerText,a=document.createElement("div");a.classList.add("ait-code-toolbox");let n=document.createElement("button");n.value=s.__("Copy"),n.classList.add("ait-code-copy"),n.setAttribute("data-content",e),n.textContent=n.value,a.append(n);let i=document.createElement("button");i.value=s.__("Download"),i.classList.add("ait-code-download"),i.setAttribute("data-content",e);let o=Object.values(t.classList).join(" ");i.setAttribute("data-type",o.replace(/hljs language-/g,"")),i.textContent=i.value,a.append(i),t.append(a)}})),document.querySelector(".aitopia").addEventListener("mouseout",(e=>{null==e.target.closest("pre code")&&(null!=document.querySelector(".ait-code-toolbox")?document.querySelector(".ait-code-toolbox").remove():null!=document.querySelector(".ait-pre-header")?document.querySelector(".ait-pre-header").remove():(null!=document.querySelector(".ait-code-copy")&&document.querySelector(".ait-code-copy").remove(),null!=document.querySelector(".ait-code-download")&&document.querySelector(".ait-code-download").remove()))})),document.querySelector(".aitopia").addEventListener("click",(e=>{var t,a;let n=e.target;null!=(t=n.classList)&&t.contains("ait-code-copy")&&s.copyClipboard(n.getAttribute("data-content")),null!=(a=n.classList)&&a.contains("ait-code-download")&&s.downloadContent(n.getAttribute("data-content"),"plain/text","aitopia_"+Date.now()+"."+n.getAttribute("data-type"));let i=n.getAttribute("href");if(i&&-1!==i.indexOf("#")&&n.closest(".aitopia .ai_result")){let t=n.innerText;n.closest(".aitopia .ai_result").querySelectorAll("h1,h2,h3,h4,h5,h6").forEach((a=>{(a.textContent.includes(t)||a.textContent.includes(i.replace(/-/," ").replace("#","")))&&(a.scrollIntoView(),e.stopPropagation(),e.preventDefault())}))}}))}downloadContent(e,t,a){const n=document.createElement("a"),s=new Blob([e],{type:t}),i=URL.createObjectURL(s);n.setAttribute("href",i),n.setAttribute("download",a),n.click(),this.notify&&this.notify.success(a+" "+this.__("Downloaded."))}encodeHTML(e){return e.replace(/([\u00A0-\u9999<>&])(.|$)/g,(function(e,t,a){return"&"!==t||"#"!==a?(/[\u00A0-\u9999<>&]/.test(a)&&(a="&#"+a.charCodeAt(0)+";"),"&#"+t.charCodeAt(0)+";"+a):e}))}decodeHTML(e){return e.replace(/&#([0-9]+);/g,(function(e,t){return String.fromCharCode(parseInt(t))}))}groupChatListener(){}sortValueLength(e=[],t="DESC"){return null==e?e:e.sort(((e,a)=>"ASC"==t?e.length-a.length:a.length-e.length))}sortObjectKeys(e){return Object.keys(e).sort().reduce((function(t,a){return t[a]=e[a],t}),{})}RegexSpecialFixer(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}fancyTimeFormat(e){const t=~~(e/3600),a=~~(e%3600/60),n=~~e%60;let s="";return t>0&&(s+=t+":"+(a<10?"0":"")),s+=a+":"+(n<10?"0":""),s+=""+n,s}isNative(e){return/\{\s*\[native code\]\s*\}/.test(""+e)}async announcementModal(e){e&&typeof e.id<"u"&&s.Browser().storage.local.get("announcements").then((t=>{let a={};typeof t.announcements<"u"&&(a=t.announcements),(typeof a[e.id]>"u"||typeof e.force<"u")&&(a[e.id]=e),s.Browser().storage.local.set({announcements:a})}))}extensionID(){return null!==g.runtime_id?g.runtime_id:g.manuel_extension_id}async checkExtension(e=!1){return g.manuel_extension_id==g.runtime_id?g.runtime_id:await s.Browser().storage.local.get(["check_extension_expire","check_extension"]).then((async t=>{let a=t.check_extension_expire??null,n=t.check_extension??g.runtime_id,i=parseInt(Date.now().toString().substring(0,10)),o=5,l={};if((a??0)>i&&!e)return n;n!=g.runtime_id&&await fetch("chrome-extension://"+n+"/aitopia/service-worker-loader.js").then((e=>e.text())).then((e=>{})).catch((async e=>{n=g.runtime_id,await s.Browser().storage.local.set({check_extension:n,check_extension_delete:!0})}));let r=(Date.now()+3e5).toString().substring(0,10);l.check_extension_expire=parseInt(r),l.check_extension=n,await s.Browser().storage.local.set(l);try{let e=await fetch("chrome-extension://"+g.manuel_extension_id+"/service-worker-loader.js").then((e=>e.text())).then((e=>{l.check_extension=g.manuel_extension_id})).catch((e=>{}))}catch{}return await s.Browser().storage.local.set(l),await s.Browser().storage.local.set({check_extension:l.check_extension}),console.log(l),l.check_extension}))}hex2rgb(e){const t=undefined,a=undefined,n=undefined;return`${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}`}simpleSymbols(e){return!/([^+]|^)[A-Za-z]([^+]|$)/.test(e)}formatCompactNumber(e,t="en"){let a={notation:"compact"};return Intl.NumberFormat(t,a).format(e)}urlToObjectUrl(e){return new URL(e)}toSeoUrl(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-")}responseByNotify(e,t=null,a=null,n=null){if(typeof e.status<"u"){if("error"==e.status)return null!==a?(s.notify.error(a),e):(s.notify.error(e.message??"error"),e);if("warning"==e.status)return null!==n?(s.notify.warning(n),e):(s.notify.warning(e.message??"error"),e)}s.notify.success(s.__("Added Agent")),console.log(e)}autoPositionDropdown=(e,t)=>{if(!e||!document.querySelector("#ai-sidebar-content"))return;const a=document.querySelector("#ai-sidebar-content");if(!a)return;const n=t||e.parentElement;if(!n)return;a.getBoundingClientRect();const s=n.getBoundingClientRect(),i=e.getBoundingClientRect(),o=window.innerWidth,l=undefined;let r="bottom",c="left";const u=window.innerHeight-s.bottom,d=s.top;u<i.height&&d>i.height&&(r="top");const g=o-s.left,p=s.right;g<i.width&&p>i.width&&(c="right"),e.classList.remove("ait-position-top","ait-position-bottom","ait-position-left","ait-position-right");let _=20;return"top"===r?(e.style.setProperty("bottom","100%","important"),e.style.setProperty("top","auto","important"),e.style.setProperty("margin-bottom","4px","important"),e.style.setProperty("margin-top","0","important")):(e.style.setProperty("top","100%","important"),e.style.setProperty("bottom","auto","important"),e.style.setProperty("margin-top","4px","important"),e.style.setProperty("margin-bottom","0","important")),"right"===c?(e.style.setProperty("right","auto","important"),e.style.setProperty("left",`-${i.width-_}px`,"important")):(e.style.setProperty("left","0","important"),e.style.setProperty("right","auto","important")),{topPosition:r,leftPosition:c}};initAutoPositionDropdowns=()=>{const e=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{var t,a;if(e.nodeType===Node.ELEMENT_NODE){const n=e;null!=(t=n.classList)&&t.contains("ait-panel-auto-position")&&setTimeout((()=>this.autoPositionDropdown(n)),10);const s=null==(a=n.querySelectorAll)?void 0:a.call(n,".ait-panel-auto-position");null==s||s.forEach((e=>{setTimeout((()=>this.autoPositionDropdown(e)),10)}))}}))}))})),t=document.querySelector("#aitopia");t&&e.observe(t,{childList:!0,subtree:!0}),document.querySelectorAll(".ait-panel-auto-position").forEach((e=>{this.autoPositionDropdown(e)}))};autoResizeTextarea=e=>{const t=e.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"};async setStorageExpiry(e,t){return await Q.setExpiry(e,t)}async removeStorageExpiry(e){return await Q.removeExpiry(e)}async getStorageRemainingTime(e){return await Q.getRemainingTime(e)}async diagramDataBuilder(e,t,a=null){if("__all"==t){let n=Object.keys(e.ai_chat).length-1,i=s.notUndefined(e,`ai_chat.${n}.events`);if(i){if(null===a)return!1;t=a._listkey,(e={ai_workflow_stream:{}}).ai_workflow_stream[t]=[],e.ai_workflow_stream[t].push({events:i,loading:s.notUndefined(e,`ai_chat.${n}.loading`)})}}let n=null,i=await s.Browser().storage.local.get(["ai_workflow"]),o=s.notUndefined(e,`ai_workflow_stream.${t}.0`);e=s.notUndefined(o,"events");let l=s.notUndefined(o,"loading");if(null==o&&(l=!0),null!=o&&typeof o.loading>"u"&&(l=!0),null!==o&&typeof o.loading<"u"&&0==o.loading)return i.ai_workflow[t].loading=!1,await s.Browser().storage.local.set(i),null;if(s.notUndefined(o,"finish_reason"),e){if(Object.values(e).forEach((e=>{if(s.notUndefined(e,"step_id")){let a=s.notUndefined(e,"step_id"),n={id:a,input:s.notUndefined(e,"event_data.input.prompt_replaced")||s.notUndefined(i,`ai_workflow.${t}.steps.${a}.input`)||null,output:s.notUndefined(e,"event_data.output")||null};typeof i.ai_workflow>"u"&&(i.ai_workflow={}),typeof i.ai_workflow[t]>"u"&&(i.ai_workflow[t]={}),typeof i.ai_workflow[t].steps>"u"&&(i.ai_workflow[t].steps={}),typeof i.ai_workflow[t].steps[a]>"u"&&(i.ai_workflow[t].steps[a]={}),i.ai_workflow[t].loading=l,i.ai_workflow[t].steps[a]=n}else"workflow_generation"===s.notUndefined(e,"action")&&"on_tool_end"===s.notUndefined(e,"event_type")&&(console.log(s.notUndefined(e,"event_data.output")),s.notUndefined(e,"event_data.output")&&(n=s.notUndefined(e,"event_data.output")))})),null!==n){let e=await s.Browser().storage.local.get("selected_agent");return e=s.notUndefined(e,"selected_agent"),e.title=n.title||e.title,e.description=n.description||e.description,e.personalization=n.personalization||e.personalization,e.workflow={},e.workflow.steps=n.steps||s.notUndefined(e,"workflow.steps")||[],await s.Browser().storage.local.set({selected_agent:e,diagrams:e}),null}await s.Browser().storage.local.set(i)}return i}}Object.defineProperty(String.prototype,"toFirstUpperCase",{value:function(){return this?`${this.substring(0,1).toUpperCase()}${this.substring(1)}`:this}}),Object.defineProperty(String.prototype,"toEscapeHTML",{value:function(){return this?this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):this}}),Object.defineProperty(String.prototype,"toUnEscapeHTML",{value:function(){return this?this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'"):this}}),Object.defineProperty(String.prototype,"toCapitalizeCase",{value:function(){if(!this)return this;let e=this.split(" ");return e.forEach(((t,a)=>{e[a]=t.toFirstUpperCase()})),`${e.join(" ")}`}}),Object.defineProperty(Object.prototype,"searchElement",{value:function(e){return this?(s.getSearchFilter(this,e)??[null])[0]??null:this}}),Object.defineProperty(Object.prototype,"sortKey",{value:()=>s.sortObjectKeys(void 0)}),Object.defineProperty(Array.prototype,"sortValueLength",{value:function(e="DESC"){return s.sortValueLength(this,e)}});const s=new Oe;export{X as A,_e as B,k as E,s as H,ve as R,u as S,C as a,g as c};