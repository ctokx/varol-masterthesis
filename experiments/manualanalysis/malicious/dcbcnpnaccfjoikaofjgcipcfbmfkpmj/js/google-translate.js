(function(){var t={get:function(t){return ajaxGet(t).then((function(t){return{body:t}}))},post:function(t,e){return ajaxPost(t+"?"+urlEncode(e.searchParams),e.form).then((function(t){return{body:t}}))}},e={get:function(t){return getSettings([t]).then((function(e){return e[t]}))},set:function(t,e){var n={};return n[t]=e,updateSettings(n)}},n=0;function r(n,r,a){a||(a={}),a.tld||(a.tld="com"),a.tokensTTL||(a.tokensTTL=3600);var s="https://translate.google."+a.tld;return Promise.resolve(e.get("wiz")).then((function(t){return t&&t.timestamp+1e3*a.tokensTTL>Date.now()?t:o(s).then((function(t){return t.timestamp=Date.now(),e.set("wiz",t),t}))})).then((function(t){return i(t,n,r)})).then((function(e){if(!a.validateOnly)return e.body.at||delete e.body.at,t.post(s+"/_/TranslateWebserverUi/data/batchexecute",{searchParams:e.query,form:e.body,responseType:"text"}).then((function(t){var e=t.body.match(/\d+/);return t.body.substr(e.index+e[0].length,Number(e[0]))})).then(JSON.parse).then((function(t){var e=t[0][2];return JSON.parse(e)}))}))}function a(n,r,a){a||(a={}),a.tld||(a.tld="com"),a.tokensTTL||(a.tokensTTL=3600);var i="https://translate.google."+a.tld;return Promise.resolve(e.get("wiz")).then((function(t){return t&&t.timestamp+1e3*a.tokensTTL>Date.now()?t:o(i).then((function(t){return t.timestamp=Date.now(),e.set("wiz",t),t}))})).then((function(t){return s(t,n,r)})).then((function(e){if(!a.validateOnly)return e.body.at||delete e.body.at,t.post(i+"/_/TranslateWebserverUi/data/batchexecute",{searchParams:e.query,form:e.body,responseType:"text"}).then((function(t){var e=t.body.match(/\d+/);return t.body.substr(e.index+e[0].length,Number(e[0]))})).then(JSON.parse).then((function(t){var e=t[0][2];e=JSON.parse(e);return e=e[1][0][0][5][0][0],e}))}))}function o(e){var n={"f.sid":/"FdrFJe":"(.*?)"/,bl:/"cfb2h":"(.*?)"/,at:/"SNlM0e":"(.*?)"/};return t.get(e).then((function(t){var e=t.body.indexOf("WIZ_global_data = {");if(-1==e)throw new Error("Wiz not found");var n=t.body.indexOf("<\/script>",e);return t.body.substring(e,n)})).then((function(t){var e={};for(var r in n){var a=n[r].exec(t);a?e[r]=a[1]:console.warn("Wiz property not found '"+r+"'")}return e}))}function i(t,e,r){if(!Array.isArray(r))throw new Error("Payload must be an array");return{query:{rpcids:e,"f.sid":t["f.sid"],bl:t["bl"],hl:"en","soc-app":1,"soc-platform":1,"soc-device":1,_reqid:1e5*++n+Math.floor(1e3+9e3*Math.random()),rt:"c"},body:{"f.req":JSON.stringify([[[e,JSON.stringify(r),null,"generic"]]]),at:t["at"]}}}function s(t,e,r){if(!Array.isArray(r))throw new Error("Payload must be an array");return{query:{rpcids:e,"f.sid":t["f.sid"],"source-path":"/",bl:t["bl"],hl:"vi","soc-app":1,"soc-platform":1,"soc-device":1,_reqid:1e5*++n+Math.floor(1e3+9e3*Math.random()),rt:"c"},body:{"f.req":JSON.stringify([[[e,JSON.stringify([r,[]]),null,"generic"]]]),at:t["at"]}}}async function u(){const t={continuousUseInterval:36e5,voluntaryGap:3e5,involuntaryGap:9e5},e=await getState("gtAccess")||{lastUsed:0,denyUntil:0},n=()=>setState("gtAccess",e).catch(console.error);return{isDenied(){return e.denyUntil>Date.now()},renewDenial(){e.denyUntil=Date.now()+t.involuntaryGap,n()},use(){const r=Date.now();r-e.lastUsed>t.voluntaryGap?e.intervalBegin=r:r-e.intervalBegin>t.continuousUseInterval&&(e.denyUntil=r+t.involuntaryGap),e.lastUsed=r,n()}}}window.translateGoogle=async function({text:t,from:e,to:n}){const r=await a("MkEWBc",[t,e,n,1]);return r},window.googleTranslateReady=async function(){const t=await u();if(t.isDenied())throw t.renewDenial(),new Error("Service unavailable");return r("jQ1olc",[],{validateOnly:!0})},window.googleTranslateSynthesizeSpeech=async function(t,e){const n=await u();if(n.isDenied())throw new Error("Server returns 429");n.use();const a=await r("jQ1olc",[t,e,null]);if(!a)throw new Error("Failed to synthesize text '"+t.slice(0,25)+"â€¦' in language "+e);return"data:audio/mpeg;base64,"+a[0]}})();